<!doctype html><html lang="en"><head><meta charSet="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title>Veera's Internship, Week 7: Restructuring the Project | Engineering at MAD – Digital Product Studio</title><meta name="description" content="It was time to switch to use Three.js with npm in my project. In general, what kind of architecture would the data viz app need? Instead of having our usual shader workshop, we took the time to plan the project structure." /><meta property="og:url" content="https://www.mad.ac/" /><meta property="og:title" content="Veera's Internship, Week 7: Restructuring the Project | Engineering at MAD – Digital Product Studio" /><meta property="og:description" content="It was time to switch to use Three.js with npm in my project. In general, what kind of architecture would the data viz app need? Instead of having our usual shader workshop, we took the time to plan the project structure." /><meta property="og:image" content="https://mad.ac/images/social/mad-engineering-og-light.png" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="@createdbymad" /><meta name="twitter:creator" content="@createdbymad" /><link rel="icon" href="../../favicon.ico" /><link rel="icon" href="../../favicon.svg" type="image/svg+xml" /><link rel="apple-touch-icon" href="../../apple-touch-icon.png" /><link rel="manifest" href="../../manifest.json" /><link rel="alternate" href="../feed.xml" type="application/rss+xml" title="MAD Engineering Blog Feed (RSS)" /><link rel="alternate" href="../feed.json" type="application/json" title="MAD Engineering Blog Feed (JSON)" /><link rel="preload" href="../../fonts/GT-MaruBeta-Bold.woff2" as="font" type="font/woff2" crossOrigin="true" /><link rel="preload" href="../../fonts/GT-MaruBeta-Regular.woff2" as="font" type="font/woff2" crossOrigin="true" /><link rel="stylesheet" href="../../styles/main%EF%B9%96v=431300964a77750d3c621bffa45c154cb1e8582c.css" /><script src="https://cdn.usefathom.com/script.js" data-site="ZUYODAUJ" defer></script></head><body class="blog font-serif"><header class="blog-header"><p class="blog-intro">Welcome to <a href="../../engineering.html">Engineering at MAD</a>. A space for creative tech, with words directly from our engineers.</p><nav class="blog-nav"><div class="blog-nav-home"><a href="../../index.html">mad.ac</a></div><div class="blog-nav-feeds"><a href="../feed.xml">Atom</a><a href="../feed.json">JSON</a></div></nav></header><main class="blog-content"><article class="post copy flow"><h1 class="post-title">Veera's Internship, Week 7: Restructuring the Project</h1><p class="post-byline"><span class="post-date">31/05/2021</span><span class="post-author">By <a href="../../team/veera.html">Veera Jussila</a></span></p><div class="post-content copy flow"><ul>
<li><a href="veera-intern-blog-week-1.html">Week 1: Intern&#39;s Greetings!</a></li>
<li><a href="veera-intern-blog-week-2.html">Week 2: Refining the MVP</a></li>
<li><a href="veera-intern-blog-week-3.html">Week 3: Diving Into Shaders</a></li>
<li><a href="veera-intern-blog-week-4.html">Week 4: From 2D to 3D</a></li>
<li><a href="veera-intern-blog-week-5.html">Week 5: Back to Inspiration Images</a></li>
<li><a href="veera-intern-blog-week-6.html">Week 6: Blended Approach</a></li>
</ul>
<p>While figuring out how to distort shapes with vertex shaders in glTF, we decided to give OBJ models a try with <a href="../../team/nikolai.html">Nikolai</a>. We worked with Three.js OBJLoader <a href="https://threejs.org/examples/#webgl_loader_obj">example</a> and were able to distort the default 3D model with a simple vertex shader. However, when trying to apply this knowledge to some simple 3D boxes that were exported from Blender, the result kept &quot;exploding&quot; again instead having a noisy surface.</p>
<p>A friend of mine from Goldsmiths, <a href="https://github.com/lxinspc">Nathan</a>, gave me a tip about <a href="https://threejs.org/docs/index.html?q=vertex#examples/en/helpers/VertexNormalsHelper">VertexNormalsHelper</a> in Three.js. It visualizes vertex normal vectors with arrows. I used it to compare normals of a plane, Three.js primitive box and an OBJ box exported from Blender:</p>
<p><img loading="lazy" src="../../media/1024/images/engineering/veera-intern-blog-week-7/vertex_helpers.png" srcset="../../media/512/images/engineering/veera-intern-blog-week-7/vertex_helpers.png 512w,../../media/1024/images/engineering/veera-intern-blog-week-7/vertex_helpers.png 1024w,../../media/2048/images/engineering/veera-intern-blog-week-7/vertex_helpers.png 2048w,../../media/3072/images/engineering/veera-intern-blog-week-7/vertex_helpers.png 3072w,../../media/4096/images/engineering/veera-intern-blog-week-7/vertex_helpers.png 4096w" sizes="(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw" alt="Scene with green vertex helpers" /></p>
<p>Despite triangulating the box model in Blender with many different settings, it doesn&#39;t seem to have any vertex normal vectors on its faces. To achieve smooth distortions and animations, we need good normals and meshes with plenty of vertices. This is definitely one of the priorities during the next weeks.</p>
<h2 id="time-to-npm-install">Time to npm install</h2>
<p>However, we made exciting progress with other parts of the project this week. Firstly, Nikolai had prepared a Node.js based app structure that can be useful for quick tests in many kinds of projects as it is easy to edit and copy previous sketches to make new ones:</p>
<p><img loading="lazy" src="../../media/1024/images/engineering/veera-intern-blog-week-7/file_list.png" srcset="../../media/512/images/engineering/veera-intern-blog-week-7/file_list.png 512w,../../media/1024/images/engineering/veera-intern-blog-week-7/file_list.png 1024w,../../media/2048/images/engineering/veera-intern-blog-week-7/file_list.png 2048w,../../media/3072/images/engineering/veera-intern-blog-week-7/file_list.png 3072w,../../media/4096/images/engineering/veera-intern-blog-week-7/file_list.png 4096w" sizes="(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw" alt="List of sketches in Node app" /></p>
<p>This was a good time for switching to use Three.js with npm in my project as well. So far, the library has lived in my project as a script:</p>
<pre><code class="language-javascript"><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"js/three.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre>
<p>However, many useful tools like 3D model loaders and GUIs are not included in this. When using npm instead, we have the main <code>javascript three.module.js</code> file and many other useful modules that are ready to be imported from the jsm folder. This is how Three.js <a href="https://threejs.org/examples/">examples</a> are built as well:</p>
<pre><code class="language-javascript"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"module"</span><span class="token operator">></span>
  <span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">'../build/three.module.js'</span><span class="token punctuation">;</span> <span class="token keyword">import</span> Stats <span class="token keyword">from</span> <span class="token string">'./jsm/libs/stats.module.js'</span><span class="token punctuation">;</span> <span class="token keyword">import</span> <span class="token punctuation">{</span><span class="token constant">GUI</span><span class="token punctuation">}</span> <span class="token keyword">from</span>
  <span class="token string">'./jsm/libs/dat.gui.module.js'</span><span class="token punctuation">;</span> <span class="token keyword">import</span> <span class="token punctuation">{</span>OrbitControls<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./jsm/controls/OrbitControls.js'</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre>
<p>Secondly, it was time to actually start to think about the production. What kind of architecture would the data viz app need? Instead of having our usual shader workshop, we took the time to plan the project structure. As a result, we had a to do list as a file <code>architure.md</code>:</p>
<pre><code>- [ ] Separation between server and client
- [ ] Reproducible way of running server and client
- [ ] Frontend build flow (bundle)
- [ ] Automatic deployments
- [ ] Way of iterating quickly
- [ ] Live development environment
- [ ] Graphics data loading (meshes, textures, maybe sounds)
- [ ] Twitter data loading
</code></pre>
<p>Until now, the projects’ Github repo was a mixture of my almost-up-to-date Flask files and some Three.js experiments as html files. Local version:</p>
<p><img loading="lazy" src="../../media/1024/images/engineering/veera-intern-blog-week-7/folder_before.png" srcset="../../media/512/images/engineering/veera-intern-blog-week-7/folder_before.png 512w,../../media/1024/images/engineering/veera-intern-blog-week-7/folder_before.png 1024w,../../media/2048/images/engineering/veera-intern-blog-week-7/folder_before.png 2048w,../../media/3072/images/engineering/veera-intern-blog-week-7/folder_before.png 3072w,../../media/4096/images/engineering/veera-intern-blog-week-7/folder_before.png 4096w" sizes="(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw" alt="Macbook folder with random files" /></p>
<p>After our restructuring process:</p>
<p><img loading="lazy" src="../../media/1024/images/engineering/veera-intern-blog-week-7/folder_after.png" srcset="../../media/512/images/engineering/veera-intern-blog-week-7/folder_after.png 512w,../../media/1024/images/engineering/veera-intern-blog-week-7/folder_after.png 1024w,../../media/2048/images/engineering/veera-intern-blog-week-7/folder_after.png 2048w,../../media/3072/images/engineering/veera-intern-blog-week-7/folder_after.png 3072w,../../media/4096/images/engineering/veera-intern-blog-week-7/folder_after.png 4096w" sizes="(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw" alt="Macbook folder with Node.js structure" /></p>
<p>The project now uses a bundler as well. This is to automate the combining and loading of Javascript files, to enhance performance and to save us from headache with dependencies. One can learn more about bundlers from this <a href="https://javascript.plainenglish.io/intro-to-module-bundlers-fd3df36925e5">article</a> or from this <a href="https://www.youtube.com/watch?v=3UWlufSzO4k">video</a>. The bundler we chose was <a href="https://github.com/evanw/esbuild">esbuild</a> and it proved to be extremely fast.</p>
<p>Better still, my app still ran locally after the total renewal of the architecture. We could tick a few boxes!</p>
<pre><code>- [x] Separation between server and client
- [x] Reproducible way of running server and client
- [x] Frontend build flow (bundle)
- [ ] Automatic deployments
- [ ] Way of iterating quickly
- [ ] Live development environment
- [ ] Graphics data loading (meshes, textures, maybe sounds)
- [ ] Twitter data loading
</code></pre>
<hr>
</div><footer class="post-footer"><img class="post-footer-image" src="../../images/team/veera.png" alt width="120" height="120" /><p>By <a href="../../team/veera.html">Veera Jussila</a></p><p>31/05/2021</p></footer></article></main></body></html>