<!doctype html><html lang="en"><head><meta charSet="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title>Veera's Internship, Week 6: Blended Approach | Engineering at MAD – Digital Product Studio</title><meta name="description" content="In our shader sessions we decided to move from 3D primitives to imported 3D models. For this task, Three.js provides a bunch of different loaders." /><meta property="og:url" content="https://www.mad.ac/" /><meta property="og:title" content="Veera's Internship, Week 6: Blended Approach | Engineering at MAD – Digital Product Studio" /><meta property="og:description" content="In our shader sessions we decided to move from 3D primitives to imported 3D models. For this task, Three.js provides a bunch of different loaders." /><meta property="og:image" content="https://mad.ac/images/social/mad-engineering-og-light.png" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="@createdbymad" /><meta name="twitter:creator" content="@createdbymad" /><link rel="icon" href="../../favicon.ico" /><link rel="icon" href="../../favicon.svg" type="image/svg+xml" /><link rel="apple-touch-icon" href="../../apple-touch-icon.png" /><link rel="manifest" href="../../manifest.json" /><link rel="alternate" href="../feed.xml" type="application/rss+xml" title="MAD Engineering Blog Feed (RSS)" /><link rel="alternate" href="../feed.json" type="application/json" title="MAD Engineering Blog Feed (JSON)" /><link rel="preload" href="../../fonts/GT-MaruBeta-Bold.woff2" as="font" type="font/woff2" crossOrigin="true" /><link rel="preload" href="../../fonts/GT-MaruBeta-Regular.woff2" as="font" type="font/woff2" crossOrigin="true" /><link rel="stylesheet" href="../../styles/main%EF%B9%96v=431300964a77750d3c621bffa45c154cb1e8582c.css" /><script src="https://cdn.usefathom.com/script.js" data-site="ZUYODAUJ" defer></script></head><body class="blog font-serif"><header class="blog-header"><p class="blog-intro">Welcome to <a href="../../engineering.html">Engineering at MAD</a>. A space for creative tech, with words directly from our engineers.</p><nav class="blog-nav"><div class="blog-nav-home"><a href="../../index.html">mad.ac</a></div><div class="blog-nav-feeds"><a href="../feed.xml">Atom</a><a href="../feed.json">JSON</a></div></nav></header><main class="blog-content"><article class="post copy flow"><h1 class="post-title">Veera's Internship, Week 6: Blended Approach</h1><p class="post-byline"><span class="post-date">28/05/2021</span><span class="post-author">By <a href="../../team/veera.html">Veera Jussila</a></span></p><div class="post-content copy flow"><ul>
<li><a href="veera-intern-blog-week-1.html">Week 1: Intern&#39;s Greetings!</a></li>
<li><a href="veera-intern-blog-week-2.html">Week 2: Refining the MVP</a></li>
<li><a href="veera-intern-blog-week-3.html">Week 3: Diving Into Shaders</a></li>
<li><a href="veera-intern-blog-week-4.html">Week 4: From 2D to 3D</a></li>
<li><a href="veera-intern-blog-week-4.html">Week 5: Back to Inspiration Images</a></li>
</ul>
<p>Towards the end of the last week I received great feedback from <a href="../../team/pascal.html">Pascal</a>. So far we haven&#39;t collaborated on my project, so he was able to present ideas from a fresh perspective.</p>
<p>The most fascinating idea was that the data visualization could show the room before and after the pandemic. To achieve this, one could create a button for getting the tweets either from 2019 or from the start of 2020, for example. Based on this <a href="https://stackoverflow.com/questions/64198102/collect-tweets-in-a-specific-time-period-in-tweepy-until-and-since-doesnt-work">discussion</a> on Stackoverflow, it should be doable.</p>
<p>Pascal also showed me an interesting reference by <a href="https://blobmixer.14islands.com/">14 Islands</a>. This Blobmixer is also done with Three.js and has the shiny, sticky visuals I would want to achieve. One can approach this task in many ways, but in our case we try to build interesting visuals with vertex and fragment shaders that can then be applied to the walls and objects in the room.</p>
<h2 id="importing-3d-models">Importing 3D models</h2>
<p>In our shader sessions we decided to move from 3D primitives to 3D models exported from Blender. For example, we had bumped into some limitations while building the room out of plane primitives. This bubbly <a href="https://github.com/spite/vertex-displacement-noise-3d-webgl-glsl-three-js">vertex shader</a> did not look so convincing when applied to a bunch of planes with visible edges, but looks much better on the sphere primitive:</p>
<p><img loading="lazy" src="../../media/1024/images/engineering/veera-intern-blog-week-6/vertex_shader_noise.png" srcset="../../media/512/images/engineering/veera-intern-blog-week-6/vertex_shader_noise.png 512w,../../media/1024/images/engineering/veera-intern-blog-week-6/vertex_shader_noise.png 1024w,../../media/2048/images/engineering/veera-intern-blog-week-6/vertex_shader_noise.png 2048w,../../media/3072/images/engineering/veera-intern-blog-week-6/vertex_shader_noise.png 3072w,../../media/4096/images/engineering/veera-intern-blog-week-6/vertex_shader_noise.png 4096w" sizes="(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw" alt="Colorful planes and sphere affected with noise" /></p>
<p>Three.js provides a bunch of different <a href="https://threejs.org/docs/index.html#manual/en/introduction/Loading-3D-models">loaders</a> for importing 3D models. The recommended format is glTF. Their glTFLoader <a href="https://threejs.org/docs/index.html#examples/en/loaders/GLTFLoader">documentation</a> gave us good tips, but eventually I found a simpler way to upload the model while searching on <a href="https://stackoverflow.com/questions/56660584/how-to-override-gltf-materials-in-three-js">Stackoverflow</a>:</p>
<pre><code class="language-javascript">loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">"models/boxTemplate4.gltf"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">gltf</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> model <span class="token operator">=</span> gltf<span class="token punctuation">.</span>scene<span class="token punctuation">;</span>
  model<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span>isMesh<span class="token punctuation">)</span> o<span class="token punctuation">.</span>material <span class="token operator">=</span> modelMaterial<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  model<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">72</span><span class="token punctuation">;</span>
  model<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  model<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
  model<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>In Blender, I had created a cube without the front wall and it accepted one of the Three.js&#39;s example fragment shaders happily:</p>
<p><img loading="lazy" src="../../media/1024/images/engineering/veera-intern-blog-week-6/plain_cube.png" srcset="../../media/512/images/engineering/veera-intern-blog-week-6/plain_cube.png 512w,../../media/1024/images/engineering/veera-intern-blog-week-6/plain_cube.png 1024w,../../media/2048/images/engineering/veera-intern-blog-week-6/plain_cube.png 2048w,../../media/3072/images/engineering/veera-intern-blog-week-6/plain_cube.png 3072w,../../media/4096/images/engineering/veera-intern-blog-week-6/plain_cube.png 4096w" sizes="(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw" alt="Plain 3D cube, grey" />
<img loading="lazy" src="../../media/1024/images/engineering/veera-intern-blog-week-6/cube_fragment_shader.png" srcset="../../media/512/images/engineering/veera-intern-blog-week-6/cube_fragment_shader.png 512w,../../media/1024/images/engineering/veera-intern-blog-week-6/cube_fragment_shader.png 1024w,../../media/2048/images/engineering/veera-intern-blog-week-6/cube_fragment_shader.png 2048w,../../media/3072/images/engineering/veera-intern-blog-week-6/cube_fragment_shader.png 3072w,../../media/4096/images/engineering/veera-intern-blog-week-6/cube_fragment_shader.png 4096w" sizes="(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw" alt="3D cube with blue and orange shader" /></p>
<p>However, this was a beginning for lengthy debugging. I combined the fragment shader above with the previously mentioned <a href="https://github.com/spite/vertex-displacement-noise-3d-webgl-glsl-three-js">noisy vertex shader</a> and started to apply the combination to different shapes:</p>
<pre><code class="language-javascript"><span class="token keyword">const</span> planeRight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>
  planeGeo<span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>ShaderMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    vertexShader<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"explosionVertexShader"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent<span class="token punctuation">,</span>
    fragmentShader<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"fragmentShader2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent<span class="token punctuation">,</span>
    uniforms<span class="token operator">:</span> uniformsSides
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
planeRight<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
planeRight<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">70</span><span class="token punctuation">;</span>
planeRight<span class="token punctuation">.</span><span class="token function">rotateY</span><span class="token punctuation">(</span><span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>planeRight<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>This worked fine with planes, but it exploded the glTF model into pieces, instead of providing bubbly noise:</p>
<p><img loading="lazy" src="../../media/1024/images/engineering/veera-intern-blog-week-6/explosion.png" srcset="../../media/512/images/engineering/veera-intern-blog-week-6/explosion.png 512w,../../media/1024/images/engineering/veera-intern-blog-week-6/explosion.png 1024w,../../media/2048/images/engineering/veera-intern-blog-week-6/explosion.png 2048w,../../media/3072/images/engineering/veera-intern-blog-week-6/explosion.png 3072w,../../media/4096/images/engineering/veera-intern-blog-week-6/explosion.png 4096w" sizes="(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw" alt="glTF model is broken into thin lines" /></p>
<p>I continued debugging by using both the fragment and vertex shader from Spite’s repo. It worked fine with the sphere, but continued to break the glTF which is only visible as thin lines in the screenshot below :</p>
<p><img loading="lazy" src="../../media/1024/images/engineering/veera-intern-blog-week-6/sphere_and_lines.png" srcset="../../media/512/images/engineering/veera-intern-blog-week-6/sphere_and_lines.png 512w,../../media/1024/images/engineering/veera-intern-blog-week-6/sphere_and_lines.png 1024w,../../media/2048/images/engineering/veera-intern-blog-week-6/sphere_and_lines.png 2048w,../../media/3072/images/engineering/veera-intern-blog-week-6/sphere_and_lines.png 3072w,../../media/4096/images/engineering/veera-intern-blog-week-6/sphere_and_lines.png 4096w" sizes="(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw" alt="A noisy sphere and lines in a colourful room" /></p>
<p>Next, my plan is to take a better look into <a href="https://discourse.threejs.org/t/calculating-vertex-normals-after-displacement-in-the-vertex-shader/16989">normals</a> and to test the current shaders with some ready glTF models to make sure that the problem is not in my export process in Blender.</p>
<p>However, I also got some ideas from the beautiful accidents like below. Could a plant or object grow through a wall?</p>
<p><img loading="lazy" src="../../media/1024/images/engineering/veera-intern-blog-week-6/through_wall_screenshot.png" srcset="../../media/512/images/engineering/veera-intern-blog-week-6/through_wall_screenshot.png 512w,../../media/1024/images/engineering/veera-intern-blog-week-6/through_wall_screenshot.png 1024w,../../media/2048/images/engineering/veera-intern-blog-week-6/through_wall_screenshot.png 2048w,../../media/3072/images/engineering/veera-intern-blog-week-6/through_wall_screenshot.png 3072w,../../media/4096/images/engineering/veera-intern-blog-week-6/through_wall_screenshot.png 4096w" sizes="(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw" alt="bubbly shape coming through a wall in pink room" /></p>
<hr>
</div><footer class="post-footer"><img class="post-footer-image" src="../../images/team/veera.png" alt width="120" height="120" /><p>By <a href="../../team/veera.html">Veera Jussila</a></p><p>28/05/2021</p></footer></article></main></body></html>