{"version":"https://jsonfeed.org/version/1","title":"MAD Engineering Blog","home_page_url":"https://mad.ac/engineering","feed_url":"https://www.mad.ac/feed.json","description":"A RSS news feed containing the latest MAD Engineering articles.","icon":"https://mad.ac/favicon.svg","favicon":"https://mad.ac/favicon.ico","items":[{"id":"https://mad.ac/engineering/blog/veera-intern-blog-week-13","url":"https://mad.ac/engineering/blog/veera-intern-blog-week-13","title":"May: Finishing Touches","content_html":"<ul>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-1\">Week 1: Intern&#39;s Greetings!</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-2\">Week 2: Refining the MVP</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-3\">Week 3: Diving Into Shaders</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-4\">Week 4: From 2D to 3D</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-5\">Week 5: Back to Inspiration Images</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-6\">Week 6: Blended Approach</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-7\">Week 7: Restructuring the Project</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-8\">Week 8: Drawing Board</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-9\">Week 9: Arranging Furniture</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-10\">Week 10: Materials and Classes</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-11\">Week 11: Different Room Types</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-12\">Week 12: Planning for the Final Weeks</a></li>\n</ul>\n<p>In the beginning of May, we had a functioning Flask app that was able to take a Twitter username and generate a custom 3D room as a response. However, we wanted to take the app further by giving more thought to some details. I’ll focus on three things: adding generative sculptures, improving the performance on the Flask side and designing a start and loading page.</p>\n<p>Initially, I had three different 3D models that I was using as sculptures in the room. These were by <a href=\"https://sketchfab.com/3d-models/head-of-david-but-with-hay-585af747e89f4e78afda322c487a5059\">doubletwisted</a>, <a href=\"https://sketchfab.com/3d-models/deformed-ball-4e92e4edb588403d8f5955ad88d2a798\">Aiekick</a> and <a href=\"https://sketchfab.com/3d-models/assignment-1-abstract-sculpture-7b7ba579c6d24d7d9f924e9e7d89c299\">justindesigner</a>. However, <a href=\"https://mad.ac/team/nikolai\">Nikolai</a> and I thought that sculptures could be a natural way to introduce more generative elements in the room. We studied some shape grammar experiments by <a href=\"https://observablehq.com/@mayagao/basic-shape-grammar-designs\">Maya Gao</a> and became interested in them. Nikolai also suggested testing L-systems to create organic shapes and provided me with some code to build on.</p>\n<p>I ended up switching between three different sculpture types in the room: one with randomly placed boxes (in picture), one blob-like made with <a href=\"https://threejs.org/docs/#api/en/geometries/TorusGeometry\">TorusGeometries</a> and a L-system and one that is deforming one big TorusGeometry.</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-13/box_sculpture.png\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-13/box_sculpture.png 512w,/media/1024/images/engineering/veera-intern-blog-week-13/box_sculpture.png 1024w,/media/2048/images/engineering/veera-intern-blog-week-13/box_sculpture.png 2048w,/media/3072/images/engineering/veera-intern-blog-week-13/box_sculpture.png 3072w,/media/4096/images/engineering/veera-intern-blog-week-13/box_sculpture.png 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"Box sculpture\" /></p>\n<p>Code for the BoxSculpture class as an example:</p>\n<pre><code class=\"language-javascript\">export class BoxSculpture {\n  constructor({\n    dim = 20,\n    width = 4,\n    height = 4,\n    depth = 4,\n    numOf = 600,\n  } = {}) {\n\n    function makeCube(dim) {\n      let cube = [];\n      for (let x = 0; x &lt; dim; x++) {\n        cube[x] = [];\n        for (let y = 0; y &lt; dim; y++) {\n          cube[x][y] = [];\n          for (let z = 0; z &lt; dim; z++) {\n            cube[x][y][z] = 0;\n          }\n        }\n      }\n      return cube;\n    }\n\n    function randomPoint(dim) {\n      return Math.floor(Math.random() * dim);\n    }\n\n    function randomPosition(dim) {\n      return [randomPoint(dim), randomPoint(dim), randomPoint(dim)];\n    }\n\n    function hasSpace(cube, [x, y, z]) {\n      for (let i = x - 0.5 * width; i &lt;= x + 0.5 * width; i++) {\n        if (i &lt; 0 || i &gt; cube.length - 1) {\n          return false;\n        }\n        for (let j = y - 0.5 * height; j &lt;= y + 0.5 * height; j++) {\n          if (j &lt; 0 || j &gt; cube.length - 1) {\n            return false;\n          }\n          for (let k = z - 0.5 * depth; k &lt;= z + 0.5 * depth; k++) {\n            if (k &lt; 0 || k &gt; cube.length - 1) {\n              return false;\n            }\n            if (cube[i][j][k] === 1) {\n              return false;\n            }\n          }\n        }\n      }\n      return true;\n    }\n\n    let bound = makeCube(dim);\n    const sculpt = new THREE.Group();\n\n    const standHeight = 20;\n    const standGeometry = new THREE.BoxGeometry(18, standHeight, 18, 30, 30);\n    const stand = new THREE.Mesh(standGeometry, standDarkMaterial);\n    stand.receiveShadow = true;\n    stand.castShadow = true;\n    stand.position.y = standHeight / 2;\n\n    for (let i = 0; i &lt; numOf; i++) {\n      let geometry = new THREE.BoxGeometry(\n        (width / dim) * (Math.floor(Math.random() * 3) + 1),\n        (height / dim) * (Math.floor(Math.random() * 3) + 1),\n        (depth / dim) * (Math.floor(Math.random() * 3) + 1),\n        10,\n        10\n      );\n      // these are blocks that we add to the group and finally draw\n      const block = new THREE.Mesh(geometry, sharpMaterial);\n      // individual random position with each round of the loop\n      let position = randomPosition(dim);\n      if (bound[position[0]][position[1]][position[2]] === 0) {\n        block.position.x = position[0] * (width / dim) - width / 2;\n        block.position.y =\n          position[1] * (height / dim) + standHeight + 0.5 * (height / dim);\n        block.position.z = position[2] * (depth / dim) - depth / 2;\n        block.castShadow = true;\n        block.receiveShadow = true;\n        // add that small cube to the group\n        sculpt.add(block);\n        bound[position[0]][position[1]][position[2]] = 1;\n      }\n    }\n\n    sculpt.add(stand);\n    // this is the result that class returns\n    return sculpt;\n  }\n}\n</code></pre>\n<p>In the main code:</p>\n<pre><code class=\"language-javascript\">const sculpture = new BoxSculpture({\n  // value coming from data\n  dim: resizeBoxes,\n  width: 26,\n  height: 36,\n  depth: 26,\n  numOf: 30,\n});\n\nsculpture.position.x = 20;\nsculpture.position.y = 0;\nsculpture.position.z = -20;\nscene.add(sculpture);\n</code></pre>\n<p>Virtually every user gets a unique sculpture because of randomness and differencies in data, so it was definitely worth it to spend some time studying generative rules.</p>\n<h2 id=\"minimalist-design\">Minimalist Design</h2>\n<p>On the Python side, we wanted to improve performance. One important change was to get rid of a text file called <code>textMass.txt</code>. I had previously appended all the user’s tweets to that one file in to make it easier to inspect during prototyping. However, this had meant opening the text file, appending to it and closing it before moving on to calculations. A much more straightforward solution is just using a string instead:</p>\n<pre><code class=\"language-python\">textMass = &quot;&quot;\n</code></pre>\n<p>Then cleaning the tweet and adding it to a long string in for loop:</p>\n<pre><code class=\"language-python\">cleanedText = cleanTxt(tweet.full_text)\ntextMass += cleanedText\n</code></pre>\n<p>And outside the for loop:</p>\n<pre><code class=\"language-python\">// ready for calculating NLP values\nwhole_text_sample = TextBlob(textMass)\n</code></pre>\n<p>I also learned how great <a href=\"https://www.w3schools.com/python/python_sets.asp\">sets</a> can be for NLP calculations. Since they ignore duplicate values, they can easily be used to store unique words of the text corpus:</p>\n<pre><code class=\"language-python\">for sentence in whole_text_sample.sentences:\n    for word in sentence.tags:\n        uniqueWords.add(word[0])\n        # checking tags that indicate verbs\n        if word[1] == &#39;JJ&#39; or word[1]==&#39;JJR&#39; or word[1]==&#39;JJS&#39;:\n            uniqueAdjectives.add(word[0])\n</code></pre>\n<p>Finally, it was time to design a minimal start page and add a loading page. I created a simple design with a gradient background that resonated with the sky shader of the 3D scene. <a href=\"https://mad.ac/team/nicholas\">Nicholas</a> suggested using a blue background instead, as a reference to Twitter, and made great suggestions for the <a href=\"https://rsms.me/inter/\">font</a> and the spacing of the elements. The loading page is simply a div element that is only displayed while the scene is loading.</p>\n<pre><code class=\"language-css\">#loadingImg {\nbackground-color: #54a1e9;\nbackground: linear-gradient(#54a1e9, #7ba7f8);  /*optional*/\nmargin: 0;\nheight: 100%;\nwidth: 100%;\nbackground-attachment: fixed;\nfont-weight: 400;\nfont-size: 16px;\nopacity: 0.9;\nposition: fixed;\ntop: 0;\nleft: 0;\ndisplay: flex;\nalign-items: center;\njustify-content: center;\ntransition: opacity 1000ms ease-in-out;\n}\n\n#loadingImg.animate-out {\n  opacity: 0;\n}\n\n#loadingImg p {\n  animation-name: pulse;\n  animation-duration: 1000ms;\n  animation-iteration-count: infinite;\n  animation-timing-function: ease-in-out;\n}\n</code></pre>\n<p>These are the data values that are affecting the room in its current form:</p>\n<ul>\n<li><strong>Average tone</strong>: room type, the plant type vs. a pool, sky colors, plant shape, artwork type, artwork and mirror frame, sculpture type and shape</li>\n<li><strong>Number of positive / negative / neutral tweets</strong>: tints and shades, sky colors, pillows vs. chair</li>\n<li><strong>Average subjectivity</strong>: height of the mirror</li>\n<li><strong>Number of &quot;I&quot;, &quot;me&quot;, &quot;myself&quot;, &quot;my&quot; and &quot;mine&quot;</strong>: width of the mirror</li>\n<li><strong>Average sentence length</strong>: sky colors</li>\n<li><strong>Number of unique words</strong>: level of detail in the artwork, sculpture type, sculpture detail in torus sculpture</li>\n<li><strong>Interactions with other users</strong>: window size, plant growth</li>\n<li><strong>Number of adjectives</strong>: sculpture dimensions, sculpture shape in torus sculpture</li>\n<li><strong>Number of &quot;nature&quot;, &quot;plants&quot; and &quot;animals&quot;</strong>: a possible extra plant</li>\n<li><strong>&quot;Love&quot; mentioned twice or more</strong>: a pink table</li>\n</ul>\n<p>I already have plenty of ideas how the project could be taken further. I would love to implement <a href=\"https://mad.ac/team/pascal\">Pascal&#39;s</a> idea of creating different rooms for different time periods; for example, comparing someone&#39;s Twitter room before and after the pandemic by limiting Tweepy’s search accordingly. One could also switch from Twitter to other text sources. One option would be to create a room that reflects one’s browsing history, or to compare the rooms for classic novels by using <a href=\"https://www.gutenberg.org/\">Project Gutenberg</a>.</p>\n<p>All in all, one single project managed to teach me new skills in NLP, introduce me to Three.js and take my web development skills to a new level. I’m thankful for the great teammates at MAD and I hope you readers have enjoyed the blog series as well!</p>\n<p><a href=\"https://tweetspace.mad.ac/\">Tweet Room app</a></p>\n<hr>\n","date_published":"Tue, 29 Jun 2021 10:45:02 GMT","author":{"name":"Veera Jussila","url":"https://mad.ac/team/veera"}},{"id":"https://mad.ac/engineering/blog/veera-intern-blog-week-12","url":"https://mad.ac/engineering/blog/veera-intern-blog-week-12","title":"Veera's Internship, Week 12: Planning for the Final Weeks","content_html":"<ul>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-1\">Week 1: Intern&#39;s Greetings!</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-2\">Week 2: Refining the MVP</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-3\">Week 3: Diving Into Shaders</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-4\">Week 4: From 2D to 3D</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-5\">Week 5: Back to Inspiration Images</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-6\">Week 6: Blended Approach</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-7\">Week 7: Restructuring the Project</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-8\">Week 8: Drawing Board</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-9\">Week 9: Arranging Furniture</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-10\">Week 10: Materials and Classes</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-11\">Week 11: Different Room Types</a></li>\n</ul>\n<p>This week, I focused on editing some visual details. For example, inspired by the discussion with <a href=\"https://mad.ac/team/nicholas\">Nicholas</a>, I decided that every room should have a mirror, its size and other properties being determined by data. So far, I had only included a mirror if the account in question was very subjective in its tone. However, a mirror gives a lot of character to the room, and putting something there to replace it felt a bit artificial to begin with.</p>\n<p>I also experimented with the mirror frames. Depending on the general design of the room, the frame now has a golden, wooden or dark, metallic finish. When creating the wooden frame, I learned that <a href=\"https://threejs.org/docs/#api/en/materials/MeshBasicMaterial\">MeshBasicMaterial</a> becomes handy with textures:</p>\n<pre><code class=\"language-javascript\">let texture = new THREE.TextureLoader().load(&quot;/static/hardwood2_diffuse.jpeg&quot;);\ntexture.wrapS = texture.wrapT = THREE.RepeatWrapping;\nlet material = new THREE.MeshBasicMaterial({\n  map: texture\n});\n</code></pre>\n<p>The room now has a bit more realistic window as well. This is made by turning the back plane of the room into a box and adding three other narrow boxes to the sides and top of the empty space. The abstract sculpture in the scene is by <a href=\"https://sketchfab.com/3d-models/deformed-ball-4e92e4edb588403d8f5955ad88d2a798\">Aiekick</a>.</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-12/sunlight.png\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-12/sunlight.png 512w,/media/1024/images/engineering/veera-intern-blog-week-12/sunlight.png 1024w,/media/2048/images/engineering/veera-intern-blog-week-12/sunlight.png 2048w,/media/3072/images/engineering/veera-intern-blog-week-12/sunlight.png 3072w,/media/4096/images/engineering/veera-intern-blog-week-12/sunlight.png 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"Pink room with golden mirror frame and sky\" /></p>\n<h2 id=\"more-to-come\">More to Come!</h2>\n<p>One interesting challenge was to vary the colors of the <a href=\"https://threejs.org/examples/webgl_shaders_sky.html\">sky shader</a> according to the data. After trial and error, I was able to make some changes by following the code in <a href=\"https://discourse.threejs.org/t/skyshader-example-how-to-change-colors/7907\">this discussion</a> and making those changes in my <code>sky.js</code> file that otherwise was a copy of the official Three.js sky object file. I didn&#39;t achieve the color range that I wanted yet, however, this was a nice example of taking a Three.js object and tweaking it to suit one&#39;s own purposes.</p>\n<p>It has been an intense 3 months. According to our original plan, the project should be published now as the internship would come to an end. However, we have decided to continue with the project in May as well! Though the prototype could be left as it is – it already turns Twitter data into a custom 3D visual – we thought that there is more to explore, and it&#39;s nice to give some thought to the final touches.</p>\n<p><a href=\"https://mad.ac/team/nikolai\">Nikolai</a> and I created a <a href=\"https://linear.app/\">Linear</a> board for the final weeks of the project. We placed tasks that could be interesting possibilities (introducing audio, more generative shapes etc.) but are not crucial in the backlog. This left 23 tasks in the &quot;To Do&quot; column, ranging from mapping of sky colors to improving NLP calculations on the Python side. It will be exciting to take this further!</p>\n<hr>\n","date_published":"Fri, 11 Jun 2021 15:57:02 GMT","author":{"name":"Veera Jussila","url":"https://mad.ac/team/veera"}},{"id":"https://mad.ac/engineering/blog/veera-intern-blog-week-11","url":"https://mad.ac/engineering/blog/veera-intern-blog-week-11","title":"Veera's Internship, Week 11: Different Room Types","content_html":"<ul>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-1\">Week 1: Intern&#39;s Greetings!</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-2\">Week 2: Refining the MVP</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-3\">Week 3: Diving Into Shaders</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-4\">Week 4: From 2D to 3D</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-5\">Week 5: Back to Inspiration Images</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-6\">Week 6: Blended Approach</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-7\">Week 7: Restructuring the Project</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-8\">Week 8: Drawing Board</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-9\">Week 9: Arranging Furniture</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-10\">Week 10: Materials and Classes</a></li>\n</ul>\n<p>I started the week by deciding and sketching three different room types: a pastel room, room with neutral colors and room with dark interior. At this stage, these categories are based on the positivity or negativity of the account. The material of the walls is simply decided with if statements:</p>\n<pre><code class=\"language-javascript\">if (avgTone &lt; 0.095) {\n  wallMat = new DarkMaterial({\n    color: 0x3d3b3d,\n    emissive: new THREE.Color(lightness, lightness, lightness)\n  });\n}\n</code></pre>\n<p>Within <code>DarkMaterial</code>, I&#39;m altering the final shade with variable <code>lightness</code>. I&#39;m mapping the number of negative tweets to a value between 0 and 1 that works well when determining the RGB of the emissive color. With the room with neutral or pastel colors, I&#39;m mapping the number of neutral or positive tweets respectively.</p>\n<p>I also decided that each room has a sculpture. Currently, whether the sculpture is modern or traditional depends on if the word &quot;future&quot; is mentioned on the account. If the sculpture is modern, it might be round or have sharp edges, again depending on the profile. The room also has something to sit on: depending on some data, I’ll be switching between soft pillows and a modern chair.</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-11/sunlight2.png\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-11/sunlight2.png 512w,/media/1024/images/engineering/veera-intern-blog-week-11/sunlight2.png 1024w,/media/2048/images/engineering/veera-intern-blog-week-11/sunlight2.png 2048w,/media/3072/images/engineering/veera-intern-blog-week-11/sunlight2.png 3072w,/media/4096/images/engineering/veera-intern-blog-week-11/sunlight2.png 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"Pink room with plants and pillows\" /></p>\n<p>With the sculptures, pillows and chair, I’m bringing glTF models back to my app by using some free and lightweight models from <a href=\"https://sketchfab.com/\">Sketchfab</a>. The models you can see on this post are by <a href=\"https://sketchfab.com/3d-models/modern-dining-chair-cf43cd4a84e044fd9830d3a5969fb19f\">Johnson Martin</a>, <a href=\"https://sketchfab.com/3d-models/pillow-917f876032864a4d9719a20c8fa5f492\">karymeh3d</a>, <a href=\"https://sketchfab.com/3d-models/head-of-david-but-with-hay-585af747e89f4e78afda322c487a5059\">doubletwisted</a> and <a href=\"https://sketchfab.com/3d-models/deformed-ball-4e92e4edb588403d8f5955ad88d2a798\">Aiekick</a>.</p>\n<pre><code class=\"language-javascript\">if (avgTone &gt; 0.2) {\n  loader.load(\n    &quot;/static/pillow/scene.gltf&quot;,\n\n    function (gltf) {\n      gltf.scene.traverse(function (child) {\n        if (child.isMesh) {\n          child.material = new THREE.MeshLambertMaterial({\n            color: 0x75b9db,\n            emissive: 0x8b82a5\n          });\n          child.castShadow = true;\n        }\n      });\n      gltf.scene.position.x = -10;\n      gltf.scene.position.y = 8;\n      gltf.scene.position.z = -110;\n      gltf.scene.rotateY((Math.PI / 2) * 0.85);\n      gltf.scene.scale.set(10, 10.5, 10);\n      scene.add(gltf.scene);\n    }\n  );\n}\n</code></pre>\n<p>Additionally, the scene now uses a sky and sun shader based on this <a href=\"https://threejs.org/examples/webgl_shaders_sky.html\">Three.js example</a>.</p>\n<h2 id=\"setting-the-lights\">Setting the Lights</h2>\n<p>Sometimes the room does not have a plant. In this experiment, when the tone of the account is negative enough, the plant is replaced with a small pool instead:</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-11/pool.png\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-11/pool.png 512w,/media/1024/images/engineering/veera-intern-blog-week-11/pool.png 1024w,/media/2048/images/engineering/veera-intern-blog-week-11/pool.png 2048w,/media/3072/images/engineering/veera-intern-blog-week-11/pool.png 3072w,/media/4096/images/engineering/veera-intern-blog-week-11/pool.png 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"Pool with sunlight\" /></p>\n<p>Here we can see another difference: sunlight!</p>\n<p>This week, both I and <a href=\"https://mad.ac/team/nikolai\">Nikolai</a> spent a lot of time studying the lights in Three.js. Some good resources:</p>\n<ul>\n<li><a href=\"https://discoverthreejs.com/book/first-steps/physically-based-rendering/\">Discover three.js</a></li>\n<li><a href=\"https://redstapler.co/threejs-realistic-light-shadow-tutorial/\">Red Stapler</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=T6PhV4Hz0u4/\">SimonDev</a></li>\n<li><a href=\"https://sundaysundae.co/how-to-make-low-poly-look-good/\">Sunday Sundae</a></li>\n<li><a href=\"https://threejsfundamentals.org/threejs/lessons/threejs-lights.html\">Three.js Fundamentals</a></li>\n</ul>\n<p>In the current setup, I have one <code>AmbientLight</code> giving a general, soft lightning to the room. It doesn&#39;t create shadows and it has no direction. Second, there is a <code>PointLight</code> in the ceiling that behaves a bit like a lightbulb. There is also a <code>Spotligt</code> directed at the plant and the vase. Finally, my favorite: a yellow <code>RectArea</code> light that is basically a plane that simulates sunlight right where the window is.</p>\n<p>Lights and materials proved to be a huge topic as, for example, plants using <code>PhongMaterial</code> went black when combined with the <code>physicallyCorrectLights</code> setting that worked well with <code> StandardMaterial</code>.</p>\n<p><a href=\"https://mad.ac/team/nicholas\">Nicholas</a> joined one of our sessions and gave good feedback on the visuals. For example, he suggested that the loud patterns of the floor could be used on smaller object instead so that objects on the floor are able to stand out. I agree; the floor patterns can easily be used to create an abstract painting.</p>\n<hr>\n","date_published":"Thu, 10 Jun 2021 16:15:02 GMT","author":{"name":"Veera Jussila","url":"https://mad.ac/team/veera"}},{"id":"https://mad.ac/engineering/blog/veera-intern-blog-week-10","url":"https://mad.ac/engineering/blog/veera-intern-blog-week-10","title":"Veera's Internship, Week 10: Materials and Classes","content_html":"<ul>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-1\">Week 1: Intern&#39;s Greetings!</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-2\">Week 2: Refining the MVP</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-3\">Week 3: Diving Into Shaders</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-4\">Week 4: From 2D to 3D</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-5\">Week 5: Back to Inspiration Images</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-6\">Week 6: Blended Approach</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-7\">Week 7: Restructuring the Project</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-8\">Week 8: Drawing Board</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-9\">Week 9: Arranging Furniture</a></li>\n</ul>\n<p>This week meant a lot of progress for the project. To keep this post compact, I will focus on two things that gave me direction: richer use of materials and introduction of classes.</p>\n<p>Firstly, as we have dived into a lot of shader programming recently, writing custom shaders has felt like the default option for creating the surfaces of the room. However, by looking at some examples, it became clear that interesting, lively surfaces don’t necessarily need a custom shader, but can also rely on creative uses of the built-in ones.</p>\n<p>One example we studied with <a href=\"https://mad.ac/team/nikolai\">Nikolai</a> was this fun <a href=\"https://www.stinkstudios.com/work/hands-wtf\">project</a> by <strong>Stink Studios</strong>. It renders a wild selection of patterns and materials on a simple, hand-shaped mesh. We were especially inspired by the way they use environment maps for reflections. If one dives into the source code in developer mode, one finds a large bunch of images that are never visible per se, but rather used to create interesting reflections on the object.</p>\n<p>So, for example, one can create a sphere or statue with <a href=\"https://threejs.org/docs/#api/en/materials/MeshStandardMaterial\">MeshStandardMaterial</a> and define its metalness and roughness. Like a real metallic object, the mesh now reflects the light sources in the room. However, maybe we want the statue to reflect some interesting colors and patterns. Or maybe we want it to reflect a room or building, sparking the viewer&#39;s imagination by hinting at something that exists outside the viewport.</p>\n<p>For this kind of results, Three.js uses environment maps. In this <a href=\"https://threejs.org/examples/#webgl_materials_displacementmap\">example</a>, the pleasant reflections are partly created with images of the Swedish Royal Palace, even if there is nothing castle-like visible in the scene.</p>\n<p>To create a pink shape that uses the six castle images for reflections, one can create a <code>reflectionCube</code> and do the following:</p>\n<pre><code class=\"language-javascript\">const path = &quot;/static/images/&quot;;\nconst format = &quot;.jpeg&quot;;\nconst urls = [\n  path + &quot;px&quot; + format,\n  path + &quot;nx&quot; + format,\n  path + &quot;py&quot; + format,\n  path + &quot;ny&quot; + format,\n  path + &quot;pz&quot; + format,\n  path + &quot;nz&quot; + format\n];\n\nconst reflectionCube = new THREE.CubeTextureLoader().load(urls);\nreflectionCube.encoding = THREE.sRGBEncoding;\nconst exampleMaterial = new THREE.MeshStandardMaterial({\n  color: 0xff80ce,\n  emissive: 0x842bd7,\n  metalness: 0.0,\n  roughness: 0.01,\n  envMap: reflectionCube,\n  envMapIntensity: 1.0\n});\n</code></pre>\n<h2 id=\"creating-plants-with-classes\">Creating Plants with Classes</h2>\n<p>We also started to make the project code more manageable by introducing classes. Again, classes are familiar to me via Processing and openFrameworks, so that made the topic easier to approach. One resource I’m going to study further is by <a href=\"https://www.w3schools.com/js/js_classes.asp\">W3Schools</a>. I usually find their tutorials very clear and pleasant to follow.</p>\n<p>In object-oriented programming, classes increase scalability and modularity. The benefits of using classes are very clear in this sort of an open-ended, experimental project. Instead of having 100 lines of code in my index.js that just generates a certain kind of a plant, I have plants.js file containing a few plant classes. Then in the main code I’m free to choose between a rose and a cactus easily, just with a few lines of code.</p>\n<pre><code class=\"language-javascript\">let plant = new ExperimentPlant();\nplant.mesh.position.x = -20;\nplant.mesh.position.y = 0;\nplant.mesh.position.z = 20;\nscene.add(plant.mesh);\n</code></pre>\n<p>Speaking of plants, I created a happy accident when exploring geometry distortions with <a href=\"https://threejs.org/examples/webgl_morphtargets.html\">morphtargets</a> . I was able to distort a box in a way that created a plant-like shape:</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-10/plant.png\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-10/plant.png 512w,/media/1024/images/engineering/veera-intern-blog-week-10/plant.png 1024w,/media/2048/images/engineering/veera-intern-blog-week-10/plant.png 2048w,/media/3072/images/engineering/veera-intern-blog-week-10/plant.png 3072w,/media/4096/images/engineering/veera-intern-blog-week-10/plant.png 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"Big plant shape in pink room\" /></p>\n<p>With help from Nikolai, I had already experimented creating plant-like shapes with spheres and for loops:</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-10/sphereplant.png\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-10/sphereplant.png 512w,/media/1024/images/engineering/veera-intern-blog-week-10/sphereplant.png 1024w,/media/2048/images/engineering/veera-intern-blog-week-10/sphereplant.png 2048w,/media/3072/images/engineering/veera-intern-blog-week-10/sphereplant.png 3072w,/media/4096/images/engineering/veera-intern-blog-week-10/sphereplant.png 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"Sphere plant shape and cylinders in pink room\" /></p>\n<p>We created a similar class-based approach to floors as well. In the main code, a floor with circle pattern can now be called just with:</p>\n<pre><code class=\"language-javascript\">const floorMat = new FloorMaterial({ type: &quot;circles&quot;, aspect: 2, scale: 1 });\n</code></pre>\n<p>Next, I will sketch a few example rooms and plan how their elements are connected. Then, within these main room types, there is variation. For example, maybe a pink wall and blue tile floor always go hand in hand, but NLP data affects how detailed the tile pattern is.</p>\n<hr>\n","date_published":"Tue, 08 Jun 2021 14:43:02 GMT","author":{"name":"Veera Jussila","url":"https://mad.ac/team/veera"}},{"id":"https://mad.ac/engineering/blog/veera-intern-blog-week-9","url":"https://mad.ac/engineering/blog/veera-intern-blog-week-9","title":"Veera's Internship, Week 9: Arranging Furniture","content_html":"<ul>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-1\">Week 1: Intern&#39;s Greetings!</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-2\">Week 2: Refining the MVP</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-3\">Week 3: Diving Into Shaders</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-4\">Week 4: From 2D to 3D</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-5\">Week 5: Back to Inspiration Images</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-6\">Week 6: Blended Approach</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-7\">Week 7: Restructuring the Project</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-8\">Week 8: Drawing Board</a></li>\n</ul>\n<p>This week, I spent time planning a function that could be used to position objects in the room. For example, I might want to place two cubes around a plant, but they should never overlap with the plant or each other. When trying to understand this problem, I found this <a href=\"https://www.youtube.com/watch?v=XATr_jdh-44\">video</a> by <strong>Daniel Shiffman</strong> very useful. That combined with pseudocode that <a href=\"https://mad.ac/team/nikolai\">Nikolai</a> provided was the key to create some functions.</p>\n<p>The pseudocode:</p>\n<pre><code class=\"language-javascript\">for (let i = 0; i &lt; max; i++) {\n  outer: for (;;) {\n    let point = make_random_point();\n    for (let j = 0; j &lt; i; j++) {\n      if (dist(locations[j], point) &lt; limit) {\n        continue outer;\n      }\n    }\n    locations.push(point);\n    break;\n  }\n}\n</code></pre>\n<p>We wanted to create arrays for the possible locations of objects, either around a circle or semicircle. There is a central object with some orbiting objects:</p>\n<pre><code class=\"language-javascript\">const locationsCircle = [];\nconst locationsHalfCircle = [];\n\nfunction neighbour_location_circle({ cx, cy, cz, min, max, startAngle = 0, endAngle = 2 * Math.PI }) {\n  // distance from the object in the center\n  const distance = min + (max - min) * Math.random();\n  const angle = startAngle + (endAngle - startAngle) * Math.random();\n  return [cx + distance * Math.cos(angle), cy, cz + distance * Math.sin(angle)];\n}\n\n// how close to each other the orbiting objects can be\nlet limit = 6;\n// number of positions to create\nlet numOfLoc = 3;\n\nfunction dist(x1, x2, y1, y2) {\n  var a = x1 - x2;\n  var b = y1 - y2;\n  return Math.sqrt(a * a + b * b);\n}\n</code></pre>\n<p>Creating positions for orbiting objects by using <code>limit</code> and checking that they don&#39;t overlap:</p>\n<pre><code class=\"language-javascript\">for (let i = 0; i &lt; numOfLoc; i++) {\n  outer: for (;;) {\n    let point = neighbour_location_circle({\n      cx: xLoc,\n      cy: yLoc,\n      cz: 5,\n      min: 15,\n      max: 25\n    });\n    for (let j = 0; j &lt; i; j++) {\n      if (dist(locationsCircle[j][0], point[0], locationsCircle[j][2], point[2]) &lt; limit) {\n        continue outer;\n      }\n    }\n    locationsCircle.push(point);\n    break;\n  }\n}\n\n// now we add spheres that orbit the box (as a circle)\nfor (let i = 0; i &lt; numOfLoc; i++) {\n  const ballGeometry = new THREE.SphereGeometry(5, 5, 5);\n  const material = new THREE.MeshPhongMaterial({\n    color: 0xffffff,\n    emissive: 0x444444\n  });\n  const ball = new THREE.Mesh(ballGeometry, material);\n  ball.position.x = locationsCircle[i][0];\n  ball.position.y = locationsCircle[i][1];\n  ball.position.z = locationsCircle[i][2];\n  scene.add(ball);\n}\n</code></pre>\n<p>For placing the objects in a semicircle (so that they don&#39;t end up inside a wall), we modify the start and end angle in the <code>neighbour_location_circle</code> function:</p>\n<pre><code class=\"language-javascript\">for (let i = 0; i &lt; numOfLoc; i++) {\n  outer: for (;;) {\n    let point = neighbour_location_circle({\n      cx: 45,\n      cy: 5,\n      cz: 5,\n      min: 15,\n      max: 25,\n      startAngle: Math.PI / 2,\n      endAngle: (3 / 2) * Math.PI\n    });\n    for (let j = 0; j &lt; i; j++) {\n      if (dist(locationsCircle[j][0], point[0], locationsCircle[j][2], point[2]) &lt; limit) {\n        continue outer;\n      }\n    }\n    locationsHalfCircle.push(point);\n    break;\n  }\n}\n</code></pre>\n<h2 id=\"adding-new-data-points\">Adding New Data Points</h2>\n<p>It was also time to make the room visuals a bit more advanced. One of the elements of the room is a big blob that floats in the middle – a bit like a brain inside a head. Luckily, when working on my own art project on my free time, I had bumped into this <a href=\"https://www.clicktorelease.com/blog/experiments-with-perlin-noise/\">resource</a> about deformations with Perlin noise.</p>\n<p>This animated blob is based on a vertex shader and fragment shader, added with a texture image. It&#39;s a good example on how to use normals and materials in deformations. An interesting thing with textures is that they can add a whole other dimension to the visual: you can use any image as a texture, and the shape will then reflect that image, hinting at a space or object that exists outside the viewport.</p>\n<p>Finally, I spent time on the Python side of the app, adding a bunch of new variables that are based on the NLP calculations. The values that client side receives are now:</p>\n<ul>\n<li><code>avgTone</code></li>\n<li><code>avgSubj</code></li>\n<li><code>numOfMe</code> (number of &quot;I&quot; and &quot;me&quot; words)</li>\n<li><code>avgSentenceLength</code></li>\n<li><code>numOfUnique</code> (number of unique words)</li>\n<li><code>interactionAmount</code> (number of @ tags)</li>\n<li><code>numOfNeg</code> (number of negative tweets)</li>\n<li><code>numOfPos</code></li>\n<li><code>numOfNeutr</code></li>\n<li><code>numOfAll</code></li>\n</ul>\n<p>I always enjoy exploring how easily Python can handle data. For example, I was prepared for requiring multiple lines of code to extract all the @ tags from an account. Finally it was just:</p>\n<pre><code class=\"language-python\">interactions = re.findall(r&#39;@[\\w\\.-]+&#39;,str(whole_text_sample))\nnumOfInteractions = len(interactions)\n</code></pre>\n<hr>\n","date_published":"Mon, 07 Jun 2021 10:10:02 GMT","author":{"name":"Veera Jussila","url":"https://mad.ac/team/veera"}},{"id":"https://mad.ac/engineering/blog/veera-intern-blog-week-8","url":"https://mad.ac/engineering/blog/veera-intern-blog-week-8","title":"Veera's Internship, Week 8: Drawing Board","content_html":"<ul>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-1\">Week 1: Intern&#39;s Greetings!</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-2\">Week 2: Refining the MVP</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-3\">Week 3: Diving Into Shaders</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-4\">Week 4: From 2D to 3D</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-5\">Week 5: Back to Inspiration Images</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-6\">Week 6: Blended Approach</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-7\">Week 7: Restructuring the Project</a></li>\n</ul>\n<p>Now that we had a nice app architecture, <a href=\"https://mad.ac/team/nikolai\">Nikolai</a> advised me to sketch the room&#39;s interiors further. We needed to have an idea of the essential elements of the room. I really enjoyed going back to prototyping on paper, just like I did throughout my studies at Goldsmiths:</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-8/sketch1.jpg\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-8/sketch1.jpg 512w,/media/1024/images/engineering/veera-intern-blog-week-8/sketch1.jpg 1024w,/media/2048/images/engineering/veera-intern-blog-week-8/sketch1.jpg 2048w,/media/3072/images/engineering/veera-intern-blog-week-8/sketch1.jpg 3072w,/media/4096/images/engineering/veera-intern-blog-week-8/sketch1.jpg 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"Room sketch, round\" />\n<img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-8/sketch2.jpg\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-8/sketch2.jpg 512w,/media/1024/images/engineering/veera-intern-blog-week-8/sketch2.jpg 1024w,/media/2048/images/engineering/veera-intern-blog-week-8/sketch2.jpg 2048w,/media/3072/images/engineering/veera-intern-blog-week-8/sketch2.jpg 3072w,/media/4096/images/engineering/veera-intern-blog-week-8/sketch2.jpg 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"Room sketch, cube\" />\n<img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-8/sketch3.jpg\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-8/sketch3.jpg 512w,/media/1024/images/engineering/veera-intern-blog-week-8/sketch3.jpg 1024w,/media/2048/images/engineering/veera-intern-blog-week-8/sketch3.jpg 2048w,/media/3072/images/engineering/veera-intern-blog-week-8/sketch3.jpg 3072w,/media/4096/images/engineering/veera-intern-blog-week-8/sketch3.jpg 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"Room sketch, another cube\" /></p>\n<p>I also collected a few Shadertoy examples that captured the simple but intriguing visuals that I was after. These examples are based on fragment shaders and buffers, not Three.js, but I wanted to share them with Nikolai as a visual reference:</p>\n<ul>\n<li><a href=\"https://www.shadertoy.com/view/3tBGzW\">Ball Room Dance</a> by shau</li>\n<li><a href=\"https://www.shadertoy.com/view/4sS3zc\">Mirror Room</a> by DiLemming</li>\n<li><a href=\"https://www.shadertoy.com/view/MldGDl\">PBR Column Room</a> by geoff</li>\n<li><a href=\"https://www.shadertoy.com/view/4sdSDs\">Reality Warp</a> by tomaes</li>\n<li><a href=\"https://www.shadertoy.com/view/lsjczK\">Mirror room</a> by Yrau</li>\n<li><a href=\"https://www.shadertoy.com/view/4ssBWr\">Grey Room</a> by lz</li>\n<li><a href=\"https://www.shadertoy.com/view/Xscyz7\">Dobrar a meta</a> by mmutai</li>\n</ul>\n<h2 id=\"getting-all-the-tweets\">Getting All the Tweets</h2>\n<p>On the Flask side, I was looking into <a href=\"https://docs.tweepy.org/en/latest/api.html\">Tweepy API</a> docs. As a default, Tweepy’s <code>api.user_timeline</code> returns 200 newest tweets from an account. However, I want all the tweets from a certain account, and possibly the ability to filter them based on date. I did some research on Stackoverflow and found that Tweepy’s <code>Cursor</code> object is a way to achieve this.</p>\n<p>Before:</p>\n<pre><code class=\"language-python\">posts = api.user_timeline(screen_name=username, count = 200, lang =&quot;en&quot;, tweet_mode=&quot;extended&quot;)\nfor tweet in posts[:199]:\n    cleanedText = cleanTxt(tweet.full_text)\n</code></pre>\n<p>After:</p>\n<pre><code class=\"language-python\">for tweet in tweepy.Cursor(api.user_timeline, screen_name=username, tweet_mode=&quot;extended&quot;).items(): # Returns all the tweets\n    cleanedText = cleanTxt(tweet.full_text)\n</code></pre>\n<p>This worked, however, it had a major impact on the performance. Whereas <code>api.user_timeline</code> returns 200 tweets almost instantly, <code>Cursor</code> object might spend one minute extracting thousands of tweets from the account. Even when limiting the number of tweets to 500, the process is very slow. This is something that needs to be solved when I focus more on the data side of the project again.</p>\n<p>By using our new project structure, we built a very simple starter scene with Nikolai. It has walls and a bunch of spheres and cubes. We agreed that I take some time to build a GUI for the scene and to create “organic” random numbers. For example, I might want to place a plant on the floor and within a certain distance from the left wall, but not always at the same x,y,z position.</p>\n<p>I was able to build a simple GUI to control minimum and maximum position coordinates and minimum and the number of spheres or cubes that would be generated. I also studied some Perlin noise <a href=\"https://gist.github.com/pkorac/bfcc434d2986a27a3e1f\">implementations</a> in order to map noise values from 0 to 1 to bigger distances in the room. With Nikolai, we went through the code that I had so far. To make the visual experiments easier, I wanted the app to remember the newest GUI settings instead of returning to default values with every page refresh. The solution was this:</p>\n<pre><code class=\"language-javascript\">const saved = JSON.parse(localStorage.getItem(&quot;params&quot;) || &quot;{}&quot;);\n\nconst params = {\n  minSpheres: 4,\n  maxSpheres: 10,\n  minX: -50,\n  minY: -50,\n  maxX: 50,\n  maxY: 50,\n  minZ: -50,\n  maxZ: 50,\n  minRadius: 2,\n  maxRadius: 20,\n  ...saved\n};\n\nfunction save() {\n  localStorage.setItem(&quot;params&quot;, JSON.stringify(params));\n}\n</code></pre>\n<hr>\n","date_published":"Wed, 02 Jun 2021 18:21:01 GMT","author":{"name":"Veera Jussila","url":"https://mad.ac/team/veera"}},{"id":"https://mad.ac/engineering/blog/veera-intern-blog-week-7","url":"https://mad.ac/engineering/blog/veera-intern-blog-week-7","title":"Veera's Internship, Week 7: Restructuring the Project","content_html":"<ul>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-1\">Week 1: Intern&#39;s Greetings!</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-2\">Week 2: Refining the MVP</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-3\">Week 3: Diving Into Shaders</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-4\">Week 4: From 2D to 3D</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-5\">Week 5: Back to Inspiration Images</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-6\">Week 6: Blended Approach</a></li>\n</ul>\n<p>While figuring out how to distort shapes with vertex shaders in glTF, we decided to give OBJ models a try with <a href=\"https://mad.ac/team/nikolai\">Nikolai</a>. We worked with Three.js OBJLoader <a href=\"https://threejs.org/examples/#webgl_loader_obj\">example</a> and were able to distort the default 3D model with a simple vertex shader. However, when trying to apply this knowledge to some simple 3D boxes that were exported from Blender, the result kept &quot;exploding&quot; again instead having a noisy surface.</p>\n<p>A friend of mine from Goldsmiths, <a href=\"https://github.com/lxinspc\">Nathan</a>, gave me a tip about <a href=\"https://threejs.org/docs/index.html?q=vertex#examples/en/helpers/VertexNormalsHelper\">VertexNormalsHelper</a> in Three.js. It visualizes vertex normal vectors with arrows. I used it to compare normals of a plane, Three.js primitive box and an OBJ box exported from Blender:</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-7/vertex_helpers.png\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-7/vertex_helpers.png 512w,/media/1024/images/engineering/veera-intern-blog-week-7/vertex_helpers.png 1024w,/media/2048/images/engineering/veera-intern-blog-week-7/vertex_helpers.png 2048w,/media/3072/images/engineering/veera-intern-blog-week-7/vertex_helpers.png 3072w,/media/4096/images/engineering/veera-intern-blog-week-7/vertex_helpers.png 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"Scene with green vertex helpers\" /></p>\n<p>Despite triangulating the box model in Blender with many different settings, it doesn&#39;t seem to have any vertex normal vectors on its faces. To achieve smooth distortions and animations, we need good normals and meshes with plenty of vertices. This is definitely one of the priorities during the next weeks.</p>\n<h2 id=\"time-to-npm-install\">Time to npm install</h2>\n<p>However, we made exciting progress with other parts of the project this week. Firstly, Nikolai had prepared a Node.js based app structure that can be useful for quick tests in many kinds of projects as it is easy to edit and copy previous sketches to make new ones:</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-7/file_list.png\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-7/file_list.png 512w,/media/1024/images/engineering/veera-intern-blog-week-7/file_list.png 1024w,/media/2048/images/engineering/veera-intern-blog-week-7/file_list.png 2048w,/media/3072/images/engineering/veera-intern-blog-week-7/file_list.png 3072w,/media/4096/images/engineering/veera-intern-blog-week-7/file_list.png 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"List of sketches in Node app\" /></p>\n<p>This was a good time for switching to use Three.js with npm in my project as well. So far, the library has lived in my project as a script:</p>\n<pre><code class=\"language-javascript\">&lt;script src=&quot;js/three.js&quot;&gt;&lt;/script&gt;\n</code></pre>\n<p>However, many useful tools like 3D model loaders and GUIs are not included in this. When using npm instead, we have the main <code>javascript three.module.js</code> file and many other useful modules that are ready to be imported from the jsm folder. This is how Three.js <a href=\"https://threejs.org/examples/\">examples</a> are built as well:</p>\n<pre><code class=\"language-javascript\">&lt;script type=&quot;module&quot;&gt;\n  import * as THREE from &#39;../build/three.module.js&#39;; import Stats from &#39;./jsm/libs/stats.module.js&#39;; import {GUI} from\n  &#39;./jsm/libs/dat.gui.module.js&#39;; import {OrbitControls} from &#39;./jsm/controls/OrbitControls.js&#39;;\n&lt;/script&gt;\n</code></pre>\n<p>Secondly, it was time to actually start to think about the production. What kind of architecture would the data viz app need? Instead of having our usual shader workshop, we took the time to plan the project structure. As a result, we had a to do list as a file <code>architure.md</code>:</p>\n<pre><code>- [ ] Separation between server and client\n- [ ] Reproducible way of running server and client\n- [ ] Frontend build flow (bundle)\n- [ ] Automatic deployments\n- [ ] Way of iterating quickly\n- [ ] Live development environment\n- [ ] Graphics data loading (meshes, textures, maybe sounds)\n- [ ] Twitter data loading\n</code></pre>\n<p>Until now, the projects’ Github repo was a mixture of my almost-up-to-date Flask files and some Three.js experiments as html files. Local version:</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-7/folder_before.png\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-7/folder_before.png 512w,/media/1024/images/engineering/veera-intern-blog-week-7/folder_before.png 1024w,/media/2048/images/engineering/veera-intern-blog-week-7/folder_before.png 2048w,/media/3072/images/engineering/veera-intern-blog-week-7/folder_before.png 3072w,/media/4096/images/engineering/veera-intern-blog-week-7/folder_before.png 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"Macbook folder with random files\" /></p>\n<p>After our restructuring process:</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-7/folder_after.png\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-7/folder_after.png 512w,/media/1024/images/engineering/veera-intern-blog-week-7/folder_after.png 1024w,/media/2048/images/engineering/veera-intern-blog-week-7/folder_after.png 2048w,/media/3072/images/engineering/veera-intern-blog-week-7/folder_after.png 3072w,/media/4096/images/engineering/veera-intern-blog-week-7/folder_after.png 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"Macbook folder with Node.js structure\" /></p>\n<p>The project now uses a bundler as well. This is to automate the combining and loading of Javascript files, to enhance performance and to save us from headache with dependencies. One can learn more about bundlers from this <a href=\"https://javascript.plainenglish.io/intro-to-module-bundlers-fd3df36925e5\">article</a> or from this <a href=\"https://www.youtube.com/watch?v=3UWlufSzO4k\">video</a>. The bundler we chose was <a href=\"https://github.com/evanw/esbuild\">esbuild</a> and it proved to be extremely fast.</p>\n<p>Better still, my app still ran locally after the total renewal of the architecture. We could tick a few boxes!</p>\n<pre><code>- [x] Separation between server and client\n- [x] Reproducible way of running server and client\n- [x] Frontend build flow (bundle)\n- [ ] Automatic deployments\n- [ ] Way of iterating quickly\n- [ ] Live development environment\n- [ ] Graphics data loading (meshes, textures, maybe sounds)\n- [ ] Twitter data loading\n</code></pre>\n<hr>\n","date_published":"Mon, 31 May 2021 18:22:01 GMT","author":{"name":"Veera Jussila","url":"https://mad.ac/team/veera"}},{"id":"https://mad.ac/engineering/blog/veera-intern-blog-week-6","url":"https://mad.ac/engineering/blog/veera-intern-blog-week-6","title":"Veera's Internship, Week 6: Blended Approach","content_html":"<ul>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-1\">Week 1: Intern&#39;s Greetings!</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-2\">Week 2: Refining the MVP</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-3\">Week 3: Diving Into Shaders</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-4\">Week 4: From 2D to 3D</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-4\">Week 5: Back to Inspiration Images</a></li>\n</ul>\n<p>Towards the end of the last week I received great feedback from <a href=\"https://mad.ac/team/pascal\">Pascal</a>. So far we haven&#39;t collaborated on my project, so he was able to present ideas from a fresh perspective.</p>\n<p>The most fascinating idea was that the data visualization could show the room before and after the pandemic. To achieve this, one could create a button for getting the tweets either from 2019 or from the start of 2020, for example. Based on this <a href=\"https://stackoverflow.com/questions/64198102/collect-tweets-in-a-specific-time-period-in-tweepy-until-and-since-doesnt-work\">discussion</a> on Stackoverflow, it should be doable.</p>\n<p>Pascal also showed me an interesting reference by <a href=\"https://blobmixer.14islands.com/\">14 Islands</a>. This Blobmixer is also done with Three.js and has the shiny, sticky visuals I would want to achieve. One can approach this task in many ways, but in our case we try to build interesting visuals with vertex and fragment shaders that can then be applied to the walls and objects in the room.</p>\n<h2 id=\"importing-3d-models\">Importing 3D models</h2>\n<p>In our shader sessions we decided to move from 3D primitives to 3D models exported from Blender. For example, we had bumped into some limitations while building the room out of plane primitives. This bubbly <a href=\"https://github.com/spite/vertex-displacement-noise-3d-webgl-glsl-three-js\">vertex shader</a> did not look so convincing when applied to a bunch of planes with visible edges, but looks much better on the sphere primitive:</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-6/vertex_shader_noise.png\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-6/vertex_shader_noise.png 512w,/media/1024/images/engineering/veera-intern-blog-week-6/vertex_shader_noise.png 1024w,/media/2048/images/engineering/veera-intern-blog-week-6/vertex_shader_noise.png 2048w,/media/3072/images/engineering/veera-intern-blog-week-6/vertex_shader_noise.png 3072w,/media/4096/images/engineering/veera-intern-blog-week-6/vertex_shader_noise.png 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"Colorful planes and sphere affected with noise\" /></p>\n<p>Three.js provides a bunch of different <a href=\"https://threejs.org/docs/index.html#manual/en/introduction/Loading-3D-models\">loaders</a> for importing 3D models. The recommended format is glTF. Their glTFLoader <a href=\"https://threejs.org/docs/index.html#examples/en/loaders/GLTFLoader\">documentation</a> gave us good tips, but eventually I found a simpler way to upload the model while searching on <a href=\"https://stackoverflow.com/questions/56660584/how-to-override-gltf-materials-in-three-js\">Stackoverflow</a>:</p>\n<pre><code class=\"language-javascript\">loader.load(&quot;models/boxTemplate4.gltf&quot;, function (gltf) {\n  const model = gltf.scene;\n  model.traverse((o) =&gt; {\n    if (o.isMesh) o.material = modelMaterial;\n  });\n  model.position.y = 72;\n  model.position.x = 0;\n  model.position.z = 20;\n  model.scale.set(4, 4, 4);\n  scene.add(model);\n});\n</code></pre>\n<p>In Blender, I had created a cube without the front wall and it accepted one of the Three.js&#39;s example fragment shaders happily:</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-6/plain_cube.png\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-6/plain_cube.png 512w,/media/1024/images/engineering/veera-intern-blog-week-6/plain_cube.png 1024w,/media/2048/images/engineering/veera-intern-blog-week-6/plain_cube.png 2048w,/media/3072/images/engineering/veera-intern-blog-week-6/plain_cube.png 3072w,/media/4096/images/engineering/veera-intern-blog-week-6/plain_cube.png 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"Plain 3D cube, grey\" />\n<img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-6/cube_fragment_shader.png\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-6/cube_fragment_shader.png 512w,/media/1024/images/engineering/veera-intern-blog-week-6/cube_fragment_shader.png 1024w,/media/2048/images/engineering/veera-intern-blog-week-6/cube_fragment_shader.png 2048w,/media/3072/images/engineering/veera-intern-blog-week-6/cube_fragment_shader.png 3072w,/media/4096/images/engineering/veera-intern-blog-week-6/cube_fragment_shader.png 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"3D cube with blue and orange shader\" /></p>\n<p>However, this was a beginning for lengthy debugging. I combined the fragment shader above with the previously mentioned <a href=\"https://github.com/spite/vertex-displacement-noise-3d-webgl-glsl-three-js\">noisy vertex shader</a> and started to apply the combination to different shapes:</p>\n<pre><code class=\"language-javascript\">const planeRight = new THREE.Mesh(\n  planeGeo,\n  new THREE.ShaderMaterial({\n    vertexShader: document.getElementById(&quot;explosionVertexShader&quot;).textContent,\n    fragmentShader: document.getElementById(&quot;fragmentShader2&quot;).textContent,\n    uniforms: uniformsSides\n  })\n);\nplaneRight.position.x = 50;\nplaneRight.position.y = 70;\nplaneRight.rotateY(-Math.PI / 2);\nscene.add(planeRight);\n</code></pre>\n<p>This worked fine with planes, but it exploded the glTF model into pieces, instead of providing bubbly noise:</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-6/explosion.png\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-6/explosion.png 512w,/media/1024/images/engineering/veera-intern-blog-week-6/explosion.png 1024w,/media/2048/images/engineering/veera-intern-blog-week-6/explosion.png 2048w,/media/3072/images/engineering/veera-intern-blog-week-6/explosion.png 3072w,/media/4096/images/engineering/veera-intern-blog-week-6/explosion.png 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"glTF model is broken into thin lines\" /></p>\n<p>I continued debugging by using both the fragment and vertex shader from Spite’s repo. It worked fine with the sphere, but continued to break the glTF which is only visible as thin lines in the screenshot below :</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-6/sphere_and_lines.png\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-6/sphere_and_lines.png 512w,/media/1024/images/engineering/veera-intern-blog-week-6/sphere_and_lines.png 1024w,/media/2048/images/engineering/veera-intern-blog-week-6/sphere_and_lines.png 2048w,/media/3072/images/engineering/veera-intern-blog-week-6/sphere_and_lines.png 3072w,/media/4096/images/engineering/veera-intern-blog-week-6/sphere_and_lines.png 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"A noisy sphere and lines in a colourful room\" /></p>\n<p>Next, my plan is to take a better look into <a href=\"https://discourse.threejs.org/t/calculating-vertex-normals-after-displacement-in-the-vertex-shader/16989\">normals</a> and to test the current shaders with some ready glTF models to make sure that the problem is not in my export process in Blender.</p>\n<p>However, I also got some ideas from the beautiful accidents like below. Could a plant or object grow through a wall?</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-6/through_wall_screenshot.png\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-6/through_wall_screenshot.png 512w,/media/1024/images/engineering/veera-intern-blog-week-6/through_wall_screenshot.png 1024w,/media/2048/images/engineering/veera-intern-blog-week-6/through_wall_screenshot.png 2048w,/media/3072/images/engineering/veera-intern-blog-week-6/through_wall_screenshot.png 3072w,/media/4096/images/engineering/veera-intern-blog-week-6/through_wall_screenshot.png 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"bubbly shape coming through a wall in pink room\" /></p>\n<hr>\n","date_published":"Fri, 28 May 2021 13:01:01 GMT","author":{"name":"Veera Jussila","url":"https://mad.ac/team/veera"}},{"id":"https://mad.ac/engineering/blog/veera-intern-blog-week-5","url":"https://mad.ac/engineering/blog/veera-intern-blog-week-5","title":"Veera's Internship, Week 5: Back to Inspiration Images","content_html":"<ul>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-1\">Week 1: Intern&#39;s Greetings!</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-2\">Week 2: Refining the MVP</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-3\">Week 3: Diving Into Shaders</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-4\">Week 4: From 2D to 3D</a></li>\n</ul>\n<p>We continued with our 3D room from the last week by adding another shader to be buffered to another wall of the room. Additionally, we placed a sphere in the middle of the room. We found out that one can actually manipulate the vertices of a SphereGeometry with noise, meaning that the 3D primitives of Three.js are much more editable than I thought.</p>\n<pre><code class=\"language-javascript\">for (const vertex of ballGeometry.vertices) {\n  vertex.normalize();\n  const distance = 20 + simplex.noise3D(vertex.x + timer * 0.1, vertex.y + timer * 0.1, vertex.z + timer * 0.1);\n  vertex.multiplyScalar(distance);\n}\nballGeometry.computeVertexNormals();\nballGeometry.computeFaceNormals();\nballGeometry.verticesNeedUpdate = true;\nballGeometry.normalsNeedUpdate = true;\n</code></pre>\n<p>However, <strong>Nikolai</strong> had a suggestion: before diving deeper into 3D shapes and deformations, he recommended me to go back to visual planning regarding the textures and the feeling I wanted to express in the app. By doing so now, we would know the exact tools we would need to learn to reach the desired result. This was a great piece of advice and also good decision regarding the workflow. Despite the endless amount of 3D and shader tutorials, there is a lot to digest as a beginner and it felt good to direct my energy to something different for a while.</p>\n<p>As an example, <a href=\"https://mad.ac/team/thabi\">Thabi</a>, Nikolai and I had the fun challenge to build some animations for a client website from scratch. Working as group of three, debugging <code>&lt;spans&gt;</code> and testing CSS animations was a refreshing change.</p>\n<h2 id=\"finding-anythingio\">Finding Anything.io</h2>\n<p>Added to that, I wanted to take a quick look into my Flask app in order to have the different parts of my project fresh in my mind. These couple of hours ended up being very effective. I’m still in the process of learning Flask, Ninja and forms.</p>\n<p>Currently the app is able to firstly analyze each tweet separately, returning the number of negative, positive and neutral tweets. Secondly, it appends all the tweets into one text file, enabling a handy access to some text traits like the most common words and the average sentence length.</p>\n<pre><code class=\"language-python\">textMass = open(&quot;textMass.txt&quot;, &quot;w&quot;)\n\nfor tweet in posts[:199]:\n    cleanedText = cleanTxt(tweet.full_text) # cleaning each tweet first\n    textMass.write(cleanedText) # adding tweets to text file\n\ntextMass.close()\nfile = open(&quot;textMass.txt&quot;)\nt = file.read()\nwhole_text_sample = TextBlob(t) # Ready to analyze the text file as TextBlob\n</code></pre>\n<p>I ended the week by searching for visual inspiration online. Nikolai provided me with an amazing source, <a href=\"https://anything.io/everything\">anything.io</a>, which takes one into a beautiful rabbit hole of inspiration images from Pinterest, Instagram and so on.</p>\n<p>I&#39;m after a visual that looks like an abstract room filled with brain cells. I don’t want the visual to be too realistic: it&#39;s rather a stage for abstract shapes and clutter to collide. I want the look to be sweet and sticky, capturing the adrenaline rushes of social media likes. There&#39;s a lot of room (pun intended) for expression: the amount of interaction the user has with the outside world could be translated to the amount of feedback in the shaders or, for example, to some holes on the walls, bringing in some new air to breathe.</p>\n<p>Some visuals and shaders that felt inspirational in this context:</p>\n<ul>\n<li><a href=\"https://twitter.com/kyndinfo/status/1367130890761949188\">Torus animation</a> by Kynd</li>\n<li><a href=\"https://anything.io/thing/rHKBsX6o33zuMXEJm\">Untitled</a> from Anything.io</li>\n<li><a href=\"https://www.cake23.de/inline-webworker-thread.html\">Inline Webworker Thread</a> from Cake23.de</li>\n<li><a href=\"https://www.cake23.de/radiant-reef+chillwave+julia-fractal-mk2.html\">Shader mashup</a> from Cake23.de</li>\n<li><a href=\"https://www.cake23.de/milkyway+bivariate-datadepth+angular-domainmap.html\">Another Shader Mashup</a> from Cake23.de</li>\n<li><a href=\"https://www.cake23.de/turing-fluid.html\">Turing fluid</a> from Cake23.de</li>\n</ul>\n<hr>\n","date_published":"Thu, 27 May 2021 08:58:00 GMT","author":{"name":"Veera Jussila","url":"https://mad.ac/team/veera"}},{"id":"https://mad.ac/engineering/blog/veera-intern-blog-week-4","url":"https://mad.ac/engineering/blog/veera-intern-blog-week-4","title":"Veera's Internship, Week 4: From 2D to 3D","content_html":"<ul>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-1\">Week 1: Intern&#39;s Greetings!</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-2\">Week 2: Refining the MVP</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-3\">Week 3: Diving Into Shaders</a></li>\n</ul>\n<p>I started the week by revisiting the MAD website shader that we had already edited with <strong>Nikolai</strong> last week. Again, I simulated incoming data by creating a few variables with random values and made them affect the RBG values of the background and foreground color:</p>\n<pre><code>gl.uniform3f(uBackgroundColor, sentiment, 0.5705882352941176, 0.4549019607843137);\ngl.uniform3f(uForegroundColor, 0.4764705882352941, polarity, 0.8117647058823529);)\n</code></pre>\n<p>Next we wanted to dive into a topic that allows for interesting chain reactions: buffers and FBOs. These are mostly familiar to me via openFrameworks. In my previous projects, I have for example switched between many FBOs with different textures based on Kinect and <a href=\"https://vimeo.com/414854407\">webcam interaction</a>.</p>\n<p>Buffer objects are a way of passing the data that shader programs need onto the GPU. (You can learn more by checking the articles by <a href=\"https://webglfundamentals.org/webgl/lessons/webgl-how-it-works.html#:~:text=Buffers%20are%20the%20way%20of,vertex%20data%20onto%20the%20GPU.&amp;text=bufferData%20copies%20data%20into%20the,to%20the%20vertex%20shader&#39;s%20attributes.\">WebGL Fundamentals</a> and by <a href=\"http://learnwebgl.brown37.net/rendering/buffer_object_primer.html\">Learn WebGL</a>.) A frame buffer object (FBO), on the other hand, acts like an additional screen: one can draw yellow cubes onto one FBO, green spheres onto the other and then draw the contents of both FBOs onto the screen where one wants to.</p>\n<p>We examined a beautiful <a href=\"https://github.com/kynd/reactive_buffers_experiment\">example</a> by <strong>Kynd</strong> where reactive buffers interact with each other, resulting in watercolour-like patterns. We studied the code and edited the shader parameters to see which of them has the most visible effect on the final result.</p>\n<h2 id=\"choosing-a-library\">Choosing a library</h2>\n<p>A bunch of interdependent 2D shaders can already get quite complex. What happens if a shader beginner wants to take them to 3D space? For my data viz project, I’m hoping to create a mental landscape where I could control the background and some other elements separately. One can imagine how amazing a 3D room would look like if its walls would be melting like in this lovely <a href=\"https://reverent-poincare-afe081.netlify.app/river/\">shader project</a> by <strong>Ezra Miller</strong>.</p>\n<p>Here, libraries come to help. Nikolai showed me some examples using <a href=\"https://github.com/oframe/ogl\">OGL</a> that could be useful for this project. However, I decided to go with Three.js due to its large variety of examples. Editable materials like <a href=\"https://threejs.org/docs/#api/en/materials/MeshStandardMaterial\">MeshStandardMaterial</a> are also a bonus. For this project Three.js is a good choice, as it takes care of the less creative bits and lets the programmer focus on the shaders affecting the visuals and interaction with data.</p>\n<p>By following <a href=\"https://github.com/mrdoob/three.js/blob/master/examples/webgl_mirror_nodes.html\">this</a> example, we created a simple 3D room from scratch and, instead of having a mirror, animated the back wall of the room based on a simple shader and a buffer:</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-4/simple_room.png\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-4/simple_room.png 512w,/media/1024/images/engineering/veera-intern-blog-week-4/simple_room.png 1024w,/media/2048/images/engineering/veera-intern-blog-week-4/simple_room.png 2048w,/media/3072/images/engineering/veera-intern-blog-week-4/simple_room.png 3072w,/media/4096/images/engineering/veera-intern-blog-week-4/simple_room.png 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"A 3d room made of planes and animated shader\" /></p>\n<hr>\n","date_published":"Tue, 04 May 2021 16:10:01 GMT","author":{"name":"Veera Jussila","url":"https://mad.ac/team/veera"}},{"id":"https://mad.ac/engineering/blog/veera-intern-blog-week-3","url":"https://mad.ac/engineering/blog/veera-intern-blog-week-3","title":"Veera's Internship, Week 3: Diving Into Shaders","content_html":"<ul>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-1\">Week 1: Intern&#39;s Greetings!</a></li>\n<li><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-2\">Week 2: Refining the MVP</a></li>\n</ul>\n<p>It was a busy and exciting week for MAD amid the launch of the new website. On Monday, we still managed to meet up with <strong>Nikolai</strong> and <a href=\"https://mad.ac/team/nicholas\">Nicholas</a> to talk about the possible visual directions for the data visualization.</p>\n<p>I was encouraged to keep the visual outcome a bit open at this point. Instead of choosing to focus on a couple of basic geometries or a painting-like shader, Nikolai suggested that I explore as much as the timetable allows. We agreed that the NLP side of the text visualization app needs to be worked on simultaneously, but for the next two weeks it makes sense to focus on understanding Three.js and shaders as they are not as familiar to me. After creating a few visually appealing animations, it is then easy to choose the most interesting one and connect that to data.</p>\n<p>I created a bunch of HTML files that I could fill with Three.js sketches and then just open them as tabs in the browser. One of the benefits of Three.js is that it can simply be included as a script in the HTML:</p>\n<pre><code>&lt;script src=&quot;js/three.js&quot;&gt;&lt;/script&gt;\n</code></pre>\n<p>…And then you are ready to create 3D scenes!</p>\n<h2 id=\"simulating-data\">Simulating data</h2>\n<p>I decided to simulate data by creating a set of random values that could be coming from the NLP and server side:</p>\n<pre><code class=\"language-javascript\">var value1 = Math.floor(Math.random() * 2001); // Could be number of tweets\nvar value2 = Math.floor(Math.random()); // between 0 and 1\nvar value3 = getRandomArbitrary(-1.0, 1.0); // Could be sentiment value between -1.0 and 1.0\nvar value4 = Math.floor(Math.random() * 21); // Could be average sentence length\nvar value5 = Array.from({ length: 2000 }, () =&gt; Math.floor(Math.random() * 4)); // Could be certain values of all the accounts 2000 tweets\n</code></pre>\n<p>I experimented with Three.js examples on groups, buffer geometries and lines. For example, I managed to make cube colors depend on an array called <code>randomValues</code>, its length being the same as the number of the cubes.</p>\n<pre><code class=\"language-javascript\">let randomValues = Array.from({ length: numberOfCubes }, () =&gt; Math.floor(Math.random() * 10));\n</code></pre>\n<p>Each index can have a value between 0-9; if the value is more than 5, color is violet. This could be a simple way to illustrate the amount of negative or positive tweets in the user account. In a similar fashion, I experimented with <a href=\"https://threejs.org/examples/#webgl_lines_sphere\">this</a> Three.js example by changing the colors and the number of triangles based on my variables:</p>\n<p><video class=\"rounded\" preload=\"none\" autoPlay playsInline muted loop width=\"1320\" height=\"1320\" poster=\"/images/engineering/veera-intern-blog-week-3/fireworks.png\"><source type=\"video/mp4\" src=\"/images/engineering/veera-intern-blog-week-3/testing_lines.mp4\"></video></p>\n<h2 id=\"first-steps-with-shaders\">First steps with shaders</h2>\n<p>In addition to this, I had an exciting shader workshop with Nikolai. I have previously used some vertex and fragment shaders in <a href=\"https://openframeworks.cc/ofBook/chapters/shaders.html\">openFrameworks</a>. There, shaders live as separate files and are loaded when the app compiles. However, we first focused on understanding how to make GLSL, ie. the language of shaders, communicate with Javascript in a web app.</p>\n<p>As an example, we inspected the shader code Nikolai had written for the background on the MAD website. The goal for me was to understand how to get fictional variables data1, data2 and data3 to have an effect on both the shader AND the Three.js side of a visual. For example, the color and pattern of the shader could be affected by the sentiment values of the Twitter account and the size of the 3D shapes by something else.</p>\n<p>In practice, shader outputs can be controlled by using uniforms. They are global shader variables that can be updated in the <code>animate()</code> function on Javascript side, for example.</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-3/shader_tuple_drawing.png\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-3/shader_tuple_drawing.png 512w,/media/1024/images/engineering/veera-intern-blog-week-3/shader_tuple_drawing.png 1024w,/media/2048/images/engineering/veera-intern-blog-week-3/shader_tuple_drawing.png 2048w,/media/3072/images/engineering/veera-intern-blog-week-3/shader_tuple_drawing.png 3072w,/media/4096/images/engineering/veera-intern-blog-week-3/shader_tuple_drawing.png 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"A gradient shader with some Tuple drawings about noise\" /></p>\n<p>We had fun tweaking colors and the amount of noise and graininess. With shaders, it is easy to get rewarding results by accident. However, I wanted to understand them better in order to actually control the visuals.</p>\n<p>We also discussed the balance between making a data-based, abstract artwork and a visual that strictly represents data (each shape is of accurate size etc.). I’m after a result that is somewhat in between. We discussed that one can illustrate the character of a text via colors, patterns, animation speeds and so on – the result is an interpretation.</p>\n<p>I will study these two shader resources before the next weeks&#39; session:</p>\n<ul>\n<li><a href=\"https://thebookofshaders.com/\">The Book of Shaders</a></li>\n<li><a href=\"https://webglfundamentals.org/webgl/lessons/webgl-shaders-and-glsl.html\">WebGLFundametals</a></li>\n</ul>\n<hr>\n","date_published":"Tue, 20 Apr 2021 11:10:01 GMT","author":{"name":"Veera Jussila","url":"https://mad.ac/team/veera"}},{"id":"https://mad.ac/engineering/blog/veera-intern-blog-week-2","url":"https://mad.ac/engineering/blog/veera-intern-blog-week-2","title":"Veera's Internship, Week 2: Refining the MVP","content_html":"<p><a href=\"https://mad.ac/engineering/blog/veera-intern-blog-week-1\">Week 1: Intern&#39;s Greetings!</a></p>\n<p>Last week I was able to build a simple Flask template with some NLP functions and a separate Three.js scene. This week I wanted to explore the possibilities further. What kind of visuals would be realistic with Twitter data and this setup?</p>\n<h2 id=\"looking-into-custom-meshes\">Looking into custom meshes</h2>\n<p>Firstly, I spent time studying Three.js resources. Three.js is known for its rich collection of <a href=\"https://threejs.org/examples/\">examples</a>, but its <a href=\"https://threejs.org/docs/\">documentation</a> can be hard to navigate when looking for specific methods. Luckily there are amazing additional resources, like <a href=\"https://discoverthreejs.com\">DiscoverThreeJs</a> by <strong>Lewy Blue</strong> and a collective effort <a href=\"https://threejsfundamentals.org/\">Three.js Fundamentals</a>.</p>\n<p>Having mostly studied generative visuals with openFrameworks and Processing, Three.js included quite a steep learning curve. One can render a simple cube or sphere very quickly with 3D primitives, but customising things requires more effort.</p>\n<p>In Three.js, one can build a 3D sphere with these both:</p>\n<pre><code>new THREE.SphereGeometry();\nnew THREE.BufferGeometry();\n</code></pre>\n<p>After studying the resources and chatting with <strong>Nikolai</strong>, it became clear that both are worth exploring in my project. I already know that I want to deform 3D shapes and change their surfaces based on data.</p>\n<p>In my Flask app, I was able to scale and rotate a <a href=\"https://threejs.org/docs/#api/en/geometries/SphereGeometry\">THREE.SphereGeometry</a> based on NLP values. However, it became clear that in order to efficiently deform a sphere with a large amount of vertices once per frame, I would need a vertex shader.</p>\n<p>With a <a href=\"https://threejs.org/docs/index.html#api/en/core/BufferGeometry\">BufferGeometry</a>, on the other hand, one can create any geometry that can be built with triangles, but one needs to define vertex positions in order to make a DIY mesh. I didn&#39;t have time to explore this option yet, but I&#39;ll do that later.</p>\n<h2 id=\"time-for-mockups\">Time for mockups</h2>\n<p>Before diving deeper into meshes, it felt like a good time to work on some mockups. For example, I had not decided yet if I wanted to treat each Twitter account as one text corpus or as separate tweets. This will have a crucial effect on the visual: will it be a space with a few objects, each representing one trait in the whole corpus, or a big bunch of small shapes, each representing one tweet?</p>\n<p>I made very simple mockups in Figma, exploring all the possible directions. I would want the MVP to have a very minimal design, with just a field where one can type a Twitter username or Twitter URL and then get a visual beside it.</p>\n<p>To illustrate the vibe of the 3D scene, I took some screenshots of Three.js examples to show my colleagues what the library can do:</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-2/figma1.png\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-2/figma1.png 512w,/media/1024/images/engineering/veera-intern-blog-week-2/figma1.png 1024w,/media/2048/images/engineering/veera-intern-blog-week-2/figma1.png 2048w,/media/3072/images/engineering/veera-intern-blog-week-2/figma1.png 3072w,/media/4096/images/engineering/veera-intern-blog-week-2/figma1.png 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"A Figma mockup of the MVP with a screenshot of Three.js example, vol 1\" />\n<img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-2/figma2.png\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-2/figma2.png 512w,/media/1024/images/engineering/veera-intern-blog-week-2/figma2.png 1024w,/media/2048/images/engineering/veera-intern-blog-week-2/figma2.png 2048w,/media/3072/images/engineering/veera-intern-blog-week-2/figma2.png 3072w,/media/4096/images/engineering/veera-intern-blog-week-2/figma2.png 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"A Figma mockup of the MVP with a screenshot of Three.js example, vol 2\" />\n<img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-2/figma3.png\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-2/figma3.png 512w,/media/1024/images/engineering/veera-intern-blog-week-2/figma3.png 1024w,/media/2048/images/engineering/veera-intern-blog-week-2/figma3.png 2048w,/media/3072/images/engineering/veera-intern-blog-week-2/figma3.png 3072w,/media/4096/images/engineering/veera-intern-blog-week-2/figma3.png 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"A Figma mockup of the MVP with a screenshot of Three.js example, vol 3\" /></p>\n<p>I shared the mockups with the team and I’m looking forward to getting their feedback. I’m interested in hearing what solutions they find visually interesting and what aspects (sentiment, most common words etc.) they would want to learn about their own Twitter accounts.</p>\n<p>Finally I made a small NLP test that proved that Python was the right choice for this project. With <a href=\"https://www.tweepy.org/\">Tweepy API</a> and <a href=\"https://textblob.readthedocs.io/en/dev/index.html\">TextBlob</a>, I was able to access a chosen Twitter account and append the sentiment values to a list with relatively few lines of code!</p>\n<pre><code class=\"language-python\"># creating empty list for the results\ntwitterResultsList = []\n\nfor tweet in posts[:199]:\n  # cleaning each tweet first\n  cleanedText = cleanTxt(tweet.full_text)\n  # making TextBlob of each cleaned tweet\n  tweet_text_sample = TextBlob(cleanedText)\n  subjectivity = tweet_text_sample.sentiment.subjectivity\n  polarity = tweet_text_sample.sentiment.polarity\n  tweetresults = (subjectivity, polarity)\n  # store each result in the list, each result pair\n  # can be used to transform one small cube\n  twitterResultsList.append(tweetresults)\n</code></pre>\n<hr>\n","date_published":"Mon, 12 Apr 2021 14:13:01 GMT","author":{"name":"Veera Jussila","url":"https://mad.ac/team/veera"}},{"id":"https://mad.ac/engineering/blog/veera-intern-blog-week-1","url":"https://mad.ac/engineering/blog/veera-intern-blog-week-1","title":"Veera's Internship, Week 1: Intern's Greetings!","content_html":"<p>How to visualize a crowded mind that results from extensive screen time?</p>\n<p>That was my first task as an intern at MAD, and not a simple one. The visualization brief was partly created by myself and partly inspired by ideas of my MAD colleagues. For the next three months it will form the basis for my own software project, including a research phase, conceptualisation phase and execution phase. Throughout the project I will engage in ideation, UI/UX, design, system architecture and development alike. This blog follows the project step-by-step, starting from February.</p>\n<h2 id=\"background\">Background</h2>\n<p>When I started the internship, there was already an interest in alternative ways for visualizing browser history at MAD. I, on the other hand, have my background in feature writing. As a creative coder I&#39;m especially excited about artistic applications of deep learning. In the project, it started to feel natural to focus on online texts that we consume daily. The goal is to make a visual representation of that experience, with the help of machine learning.</p>\n<p>When it comes to data visualization, I find <strong>Marcin Ignac</strong>’s approach interesting. Besides leading the studio <em>Variable</em>, he has explored algorithmic identities and metadata in his <a href=\"https://variable.io/you-are-io/\">own artworks</a>. Here, numeral data is translated into 3D space. This approach with data and space resonated with me, as during the pandemic we consume online contents while being confined to our homes. Our headspace increasingly reflects the online space where we spend our days.</p>\n<p>During the last week’s ideation phase, I came up with an idea of textual data as a room with clutter and furniture. <strong>Rem Koolhaas</strong> talks about <a href=\"http://maurann.com/assets/readings/koolhaas-rem_junkspace.pdf\">junkspace</a>, referring to flashy and unmemorable chunks of modern architecture that will be left behind on Earth. Would our browser history or Twitter habits reveal similar kind of junkspace if we dared to take a look?</p>\n<h2 id=\"mvp\">MVP</h2>\n<p>These ideas are broad, so it became necessary to define an MVP. After talking with others, I decided that my first goal would be a simple web app that is able to process text data with some NLP libraries and then manipulate 3D primitives based on the result. In practice, this could mean that the number of negative tweets from user X is visualized with a red sphere, its size reflecting the amount of tweets. Later on I could get more ambitious with the 3D objects and data sources (like browser history). One option is to reflect the idea of public and private spaces in the visuals: maybe Twitter visuals could live as sculptures and trees in a park and browser data visuals in a more private setting of a room with furniture and plants.</p>\n<p>For NLP, I wanted to dive into Python libraries. Node.js has handy packages like <a href=\"https://www.npmjs.com/package/natural\">Natural</a>, but Python’s selection of libraries is simply more diverse and able to handle large corpuses of text with a breeze. Additionally, I’m more experienced with Node.js than Python’s web frameworks Django and Flask so this felt like a good opportunity to learn new things with Python.</p>\n<p>After talking with my developer colleague <a href=\"https://mad.ac/team/nikolai\">Nikolai</a>, we concluded that the best approach is to first build a simple Flask app that communicates with <a href=\"https://threejs.org/\">Three.js</a>front end. As my first experiment, I built a simple app that analyzes user input with an NLP library <a href=\"https://textblob.readthedocs.io/en/dev/index.html\">textBlob</a>. With a few lines of code, the NLP library outputs the subjectivity and polarity of the user input (sentiment), then the polarity separately and finally the number of times a certain word (“UK”) is mentioned.</p>\n<p>I also added a simple 3D scene based on a Three.js <a href=\"https://threejs.org/docs/#manual/en/introduction/Creating-a-scene\">tutorial</a>. The NLP results are not affecting the 3D visual yet, but they now exist happily in the same Flask app for the next week!</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/veera-intern-blog-week-1/basic_flask_cube.png\" srcset=\"/media/512/images/engineering/veera-intern-blog-week-1/basic_flask_cube.png 512w,/media/1024/images/engineering/veera-intern-blog-week-1/basic_flask_cube.png 1024w,/media/2048/images/engineering/veera-intern-blog-week-1/basic_flask_cube.png 2048w,/media/3072/images/engineering/veera-intern-blog-week-1/basic_flask_cube.png 3072w,/media/4096/images/engineering/veera-intern-blog-week-1/basic_flask_cube.png 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"A skeleton Flask app with a Three.js scene\" /></p>\n<hr>\n","date_published":"Wed, 07 Apr 2021 16:03:01 GMT","author":{"name":"Veera Jussila","url":"https://mad.ac/team/veera"}},{"id":"https://mad.ac/engineering/blog/granular-rendering-custom-elements","url":"https://mad.ac/engineering/blog/granular-rendering-custom-elements","title":"Granular Rendering with Custom Elements","content_html":"<p>Modern frontend rendering best-practices come at a cost. Here is a sketch of a typical &quot;isomorphic&quot; rendering setup with <a href=\"https://preactjs.com/\">Preact</a>. We render our <code>&lt;App /&gt;</code> component on the server and pass the generated HTML along with the data used to generate it to the client.</p>\n<pre><code class=\"language-jsx\">// server.jsx\nimport { h } from &quot;preact&quot;;\nimport render from &quot;preact-render-to-string&quot;;\nimport express from &quot;express&quot;;\nimport { App } from &quot;./app&quot;;\n\nconst server = express();\n\nserver.get(&quot;*&quot;, (req, res) =&gt; {\n  const props = {\n    /* ...data loaded from somewhere... */\n  };\n  const html = render(&lt;App {...props} /&gt;);\n  res.send(`&lt;!DOCTYPE html&gt;\n    &lt;html&gt;\n      &lt;body&gt;\n        &lt;div id=&quot;root&quot;&gt;\n          ${html}\n        &lt;/div&gt;\n        &lt;script id=&quot;__DATA__&quot; type=&quot;application/json&quot;&gt;\n          ${JSON.stringify(props)}\n        &lt;/script&gt;\n      &lt;/body&gt;\n    &lt;/html&gt;\n  `);\n});\n\nserver.listen(8080);\n</code></pre>\n<p>And then, on the client, we use that data to &quot;hydrate&quot; our VDOM tree.</p>\n<pre><code class=\"language-jsx\">// client.jsx\nimport { h, hydrate } from &quot;preact&quot;;\nimport { App } from &quot;./app&quot;;\n\nconst props = JSON.parse(__DATA__.textContent);\nhydrate(&lt;App {...props} /&gt;, root);\n</code></pre>\n<p>This architecture is really nice, as it is simple to think about and allows us to share most of our code between client and server. Popular frameworks like <a href=\"https://nextjs.org/\">Next.js</a> and <a href=\"https://www.gatsbyjs.com/\">Gatsby</a> implement it.</p>\n<p>But herein lies the cost: We&#39;re sending all content to the client twice, once as HTML and then again as JSON. Furthermore, our page only becomes interactive when we&#39;re done <a href=\"https://reactjs.org/docs/react-dom.html#hydrate\">hydrating</a> it, and hydrating blocks the main thread—possibly for a while if our app is big or the user doesn&#39;t have a powerful CPU. Worse, in the general case, large parts of the tree that we&#39;re hydrating are static and don&#39;t update in response to state changes, meaning we wasted cycles hydrating them in the first place. <a href=\"https://developers.google.com/web/updates/2019/02/rendering-on-the-web\">&quot;Rendering on the Web&quot;</a> is a good discussion of the tradeoffs involved.</p>\n<p><a href=\"https://twitter.com/_developit\">Jason Miller</a> outlines a possible alternative in <a href=\"https://jasonformat.com/islands-architecture/\">&quot;Islands Architecture&quot;</a>:</p>\n<blockquote>\n<p>The general idea of an “Islands” architecture is deceptively simple: render HTML pages on the server, and inject placeholders or slots around highly dynamic regions. These placeholders/slots contain the server-rendered HTML output from their corresponding widget. They denote regions that can then be &quot;hydrated&quot; on the client into small self-contained widgets, reusing their server-rendered initial HTML.</p>\n</blockquote>\n<p>I want to write about one way to implement this architecture using Preact and <a href=\"https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_custom_elements\">Custom Elements</a> that we&#39;re using on the new MAD website. Custom Elements and <a href=\"https://developer.mozilla.org/en-US/docs/Web/Web_Components\">Web Components</a>, the collection of standards that Custom Elements are a part of, together with Shadow DOM and HTML templates, have received their share of <a href=\"https://dev.to/richharris/why-i-don-t-use-web-components-2cia\">criticism</a> for being an inadequate replacement for modern frontend frameworks such as React or Vue.</p>\n<p>In my mind, their strength lies not in replacing modern frameworks, but in augmenting them. Frameworks give us a component model and rendering, while Custom Elements allow us to <a href=\"https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_custom_elements#using_the_lifecycle_callbacks\">hook into</a> the browser&#39;s standard element lifecycle using <code>connectedCallback()</code> and <code>disconnectedCallback()</code>. This allows us to run code in response to a piece of HTML showing up or being removed from the page—exactly what we need for granular rendering.</p>\n<p>Let&#39;s walk through some examples of how we use this pattern on the new MAD website.</p>\n<p>The simplest example is one where we don&#39;t use any Preact at all on the client: the lazy-image element. On the server, we wrap our <code>&lt;img&gt;</code> in a <code>&lt;lazy-image&gt;</code>, pass a transparent placeholder as the <code>src</code>, with the real <code>src</code> and <code>srcset</code> tucked away in dataset attributes.</p>\n<pre><code class=\"language-jsx\">&lt;lazy-image&gt;\n  &lt;img\n    src=&quot;data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7&quot;\n    data-src=&quot;/media/1024/images/example.jpg&quot;\n    data-srcset=&quot;\n      /media/512/images/example.jpg 512w,\n      /media/1024/images/example.jpg 1024w,\n      /media/2048/images/example.jpg 2048w,\n      /media/3072/images/example.jpg 3072w,\n      /media/4096/images/example.jpg 4096w\n    &quot;\n    alt=&quot;An example image&quot;\n  /&gt;\n&lt;/lazy-image&gt;\n</code></pre>\n<p>And then, on the client, we attach an <code>IntersectionObserver</code> and switch in the real image when the element comes near the viewport.</p>\n<pre><code class=\"language-jsx\">const observer = new IntersectionObserver(\n  (entries) =&gt; {\n    for (const entry of entries) {\n      if (entry.isIntersecting) {\n        observer.unobserve(entry.target);\n        entry.target.load();\n      }\n    }\n  },\n  { rootMargin: &quot;200px&quot; }\n);\n\nexport class LazyImage extends HTMLElement {\n  connectedCallback() {\n    observer.observe(this);\n  }\n\n  disconnectedCallback() {\n    observer.unobserve(this);\n  }\n\n  load() {\n    const image = this.querySelector(&quot;img&quot;);\n\n    if (image) {\n      if (image.dataset.srcset) {\n        image.srcset = image.dataset.srcset;\n        delete image.dataset.srcset;\n      }\n\n      if (image.dataset.src) {\n        image.src = image.dataset.src;\n        delete image.dataset.src;\n      }\n    }\n  }\n}\n\ncustomElements.define(&quot;lazy-image&quot;, LazyImage);\n</code></pre>\n<p>As you can see, this level of interactivity doesn&#39;t require hydrating a whole VDOM tree. We have a similar element for lazily loading videos and starting playback when they&#39;re in the viewport.</p>\n<p>This simple example shows off one of the best things about this approach: the HTML is in control of where elements are instantiated, rather than the other way around, where a piece of JavaScript uses <code>querySelectorAll</code> or <code>MutationObserver</code> to find chunks of HTML to make interactive.</p>\n<p>Our favourite element of this kind is <code>&lt;draggable-element&gt;</code>, which you can wrap around any element to make it draggable, and which you can see in its full glory on the home page.</p>\n<pre><code class=\"language-jsx\">&lt;draggable-element id=&quot;applet-map&quot;&gt;\n  &lt;MapApplet /&gt;\n&lt;/draggable-element&gt;\n</code></pre>\n<p>Let&#39;s look at an example that uses Preact on the client next, specifically the &quot;Notes&quot; applet on the home page.</p>\n<p>On the server we include the data that the component needs for its initial render in a <code>&lt;script type=&quot;application/json&quot;&gt;</code> tag.</p>\n<pre><code class=\"language-jsx\">&lt;mad-notes&gt;\n  &lt;NotesApplet {...props} /&gt;\n  &lt;script type=&quot;application/json&quot; dangerouslySetInnerHTML={{ __html: JSON.stringify(props) }} /&gt;\n&lt;/mad-notes&gt;\n</code></pre>\n<p>And on the client we hydrate the component with that data.</p>\n<pre><code class=\"language-jsx\">import { h, hydrate } from &quot;preact&quot;;\nimport { NotesApplet } from &quot;../applets/notes&quot;;\n\nclass NotesElement extends HTMLElement {\n  connectedCallback() {\n    const props = JSON.parse(this.querySelector(&quot;script&quot;).textContent);\n    hydrate(&lt;NotesApplet {...props} /&gt;, this);\n  }\n}\n\ncustomElements.define(&quot;mad-notes&quot;, NotesElement);\n</code></pre>\n<p>And voila, our <code>&lt;NotesApplet /&gt;</code> is now interactive.</p>\n<p>This pattern becomes quite repetitive when you have more than a couple of elements, but you could wrap this up in a helper or use a library like <a href=\"https://github.com/preactjs/preact-custom-element\">preact-custom-element</a>, which also adds a few more niceties, such as observing element attributes and syncing them with Preact component props, and optionally rendering into shadow DOM.</p>\n<pre><code class=\"language-jsx\">import register from &quot;preact-custom-element&quot;;\nimport { RemindersApplet } from &quot;../applets/reminders&quot;;\n\nregister(RemindersApplet, &quot;mad-reminders&quot;);\n</code></pre>\n<p>We can do better, though.</p>\n<p>While this approach allows us to only hydrate portions of the page which should be interactive, it hydrates all of them at the same time, on page load. Meanwhile, most elements are probably off-screen, and we want to prioritise those that the user will likely interact with first.</p>\n<p>We can use an <code>IntersectionObserver</code> and a dynamic import to fetch the module and hydrate the component when its wrapping element comes close to the viewport.</p>\n<pre><code class=\"language-jsx\">import { h, hydrate } from &quot;preact&quot;;\n\nconst observer = new IntersectionObserver(\n  (entries) =&gt; {\n    for (const entry of entries) {\n      if (entry.isIntersecting) {\n        oberver.unobserve(entry.target);\n        entry.target.hydrate();\n      }\n    }\n  },\n  { rootMargin: &quot;200px&quot; }\n);\n\nclass NotesElement extends HTMLElement {\n  connectedCallback() {\n    observer.observe(this);\n  }\n\n  disconnectedCallback() {\n    observer.unobserve(this);\n  }\n\n  async hydrate() {\n    const { NotesApplet } = await import(&quot;../applets/notes&quot;);\n    const props = JSON.parse(this.querySelector(&quot;script&quot;).textContent);\n    hydrate(&lt;NotesApplet {...props} /&gt;, this);\n  }\n}\n\ncustomElements.define(&quot;mad-notes&quot;, NotesElement);\n</code></pre>\n<p>Now, we only need to load a minimal amount of JavaScript in the initial bundle, and can then load the rest of it and perform hydration when it makes sense to. Depending on your situation, you could think of other approaches for triggering hydration, such as scroll listeners or <code>mouseover</code> or <code>touchstart</code> events.</p>\n<p>You could also abstract this behaviour into a general-purpose element that can hydrate any of your Preact components, or pair this approach with a Service Worker that pre-emptively loads the code for components that are likely to be needed soon after page load, so that they&#39;re already available when the time comes to hydrate them.</p>\n<p>And that&#39;s it! Please reach out on <a href=\"https://twitter.com/nonscio\">Twitter</a> if you have questions or suggestions. Also, we&#39;re hiring! Check out our <a href=\"/careers\">careers</a> page for open positions.</p>\n<br>\n\n<hr>\n<p>Thanks to <a href=\"https://twitter.com/gryzzly\">Misha Reyzlin</a> and <a href=\"https://twitter.com/thabisegoe\">Rethabile Segoe</a> for providing valuable feedback on early drafts of this article.</p>\n<hr>\n","date_published":"Tue, 02 Mar 2021 10:39:17 GMT","author":{"name":"Nikolai Sivertsen","url":"https://mad.ac/team/nikolai"}},{"id":"https://mad.ac/engineering/blog/tools-remote-collaboration","url":"https://mad.ac/engineering/blog/tools-remote-collaboration","title":"Tools for Remote Collaboration","content_html":"<p>We&#39;re lucky to have tools available that have made collaborating from home for the last year much more bearable. There are the tools that everyone knows, such as Zoom, Slack, Notion and G Suite. They&#39;re mostly fine, and we use them too, but I wanted to write about two tools that might be a little less well-known and that we&#39;ve come to rely on.</p>\n<h2 id=\"tuple\">Tuple</h2>\n<p>We do a fair bit of pair programming at MAD. Traditional screen-sharing tools don&#39;t always make remote pair programming enjoyable, as there&#39;s no way to quickly switch who&#39;s in control of the keyboard, and latency often gets in the way of a train of thought.</p>\n<p>Enter <a href=\"http://tuple.app/\">Tuple</a>, an app made specifically for remote pair programming. A native macOS app with a C++ WebRTC core, it feels more immediate than everything else out there. It also allows you to point at a location on the screen and even draw on it, which really helps with quickly communicating an idea.</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/tools-remote-collaboration/tuple-pairing-session.jpg\" srcset=\"/media/512/images/engineering/tools-remote-collaboration/tuple-pairing-session.jpg 512w,/media/1024/images/engineering/tools-remote-collaboration/tuple-pairing-session.jpg 1024w,/media/2048/images/engineering/tools-remote-collaboration/tuple-pairing-session.jpg 2048w,/media/3072/images/engineering/tools-remote-collaboration/tuple-pairing-session.jpg 3072w,/media/4096/images/engineering/tools-remote-collaboration/tuple-pairing-session.jpg 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"A Tuple pairing session\" /></p>\n<p>It&#39;s the closest thing to programming together at one desk that I&#39;ve seen.</p>\n<p>There are sometimes bugs, and we&#39;ve been impatiently awaiting some upcoming features, such as improvements to <a href=\"https://tuple.app/blog/three-player-improvements\">three-person pairing sessions</a>, but those are actively being worked on and updates have been frequent. There&#39;s also a <a href=\"https://tuple.app/linux\">Linux client</a> in the works.</p>\n<p>It&#39;s rare that a day goes by without a Tuple session, which says a lot, I think.</p>\n<h2 id=\"tailscale\">Tailscale</h2>\n<p>Having designers and engineers sit together at one screen to go over the finer details of an interface, or to do some live prototyping, is instrumental to our process. It&#39;s where we find ideas and improvements that can&#39;t be found any other way: Obsessively resizing the viewport, clicking on elements again and again, zooming in and out, screen-recording animations to pore over them in slow motion. Screen sharing doesn&#39;t cut it in this case, as glitches and latency come in the way of the pixel- and millisecond-level precision that is necessary for this process.</p>\n<p><a href=\"https://tailscale.com/\">Tailscale</a> is a zero-config VPN that, among other things, allows you to share your localhost with team members anywhere in the world. After installing the app and authenticating via an existing identity provider, such as G Suite, Okta, Active Directory, you&#39;re assigned a stable IP address that is only accessible to people on your team.</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/tools-remote-collaboration/tailscale-menu-bar.jpg\" srcset=\"/media/512/images/engineering/tools-remote-collaboration/tailscale-menu-bar.jpg 512w,/media/1024/images/engineering/tools-remote-collaboration/tailscale-menu-bar.jpg 1024w,/media/2048/images/engineering/tools-remote-collaboration/tailscale-menu-bar.jpg 2048w,/media/3072/images/engineering/tools-remote-collaboration/tailscale-menu-bar.jpg 3072w,/media/4096/images/engineering/tools-remote-collaboration/tailscale-menu-bar.jpg 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"Tailscale macOS menu bar app\" /></p>\n<p>This means that, when working together, saving a file is enough to update the website in a team member&#39;s browser. No waiting for staging deployments or sending files around.</p>\n<p><img loading=\"lazy\" src=\"/media/1024/images/engineering/tools-remote-collaboration/tailscale-mad-website.jpg\" srcset=\"/media/512/images/engineering/tools-remote-collaboration/tailscale-mad-website.jpg 512w,/media/1024/images/engineering/tools-remote-collaboration/tailscale-mad-website.jpg 1024w,/media/2048/images/engineering/tools-remote-collaboration/tailscale-mad-website.jpg 2048w,/media/3072/images/engineering/tools-remote-collaboration/tailscale-mad-website.jpg 3072w,/media/4096/images/engineering/tools-remote-collaboration/tailscale-mad-website.jpg 4096w\" sizes=\"(min-width: 1660px) 1100px, (min-width: 1000px) calc(100vw - 560px), 100vw\" alt=\"Sharing localhost with Tailscale\" /></p>\n<p>Tailscale is built on top of the <a href=\"https://www.wireguard.com/\">Wireguard</a> protocol, which is a faster and simpler alternative to IPsec created by Jason A. Donenfeld. Wireguard provides the data plane while Tailscale acts as a controller and handles public keys, adding and removing devices from your network, and so on.</p>\n<p>Tailscale is capable of much more than sharing your localhost. You can <a href=\"https://tailscale.com/kb/1077/secure-server-ubuntu-18-04\">install it</a> on your Linux servers and share internal services without exposing them to the open internet. David Crawshaw, one of Tailscale&#39;s co-founders, describes the motivation beautifully in <a href=\"https://crawshaw.io/blog/remembering-the-lan\">&quot;Remembering the LAN&quot;</a>.</p>\n<p>Together, these two tools have given back to us some of the immediacy of face-to-face interaction that we used to take for granted. Give them a spin.</p>\n<hr>\n","date_published":"Mon, 01 Mar 2021 10:39:17 GMT","author":{"name":"Nikolai Sivertsen","url":"https://mad.ac/team/nikolai"}}]}